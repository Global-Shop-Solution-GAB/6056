Program.Sub.ScreenSU.Start
Gui.Form..Create(BaseForm)
Gui.Form..Caption("BOM compare options")
Gui.Form..Size(5070,1755)
Gui.Form..MinX(0)
Gui.Form..MinY(0)
Gui.Form..Position(0,0)
Gui.Form..BackColor(-2147483633)
Gui.Form..MousePointer(0)
Gui.Form..Event(UnLoad,Form_UnLoad)
Gui.Form..AlwaysOnTop(False)
Gui.Form..FontName("Tahoma")
Gui.Form..FontSize(8.25)
Gui.Form..ControlBox(True)
Gui.Form..MaxButton(True)
Gui.Form..MinButton(True)
Gui.Form..Moveable(True)
Gui.Form..Sizeable(False)
Gui.Form..ShowInTaskBar(True)
Gui.Form..TitleBar(True)
Gui.Form.frame1.Create(Frame)
Gui.Form.frame1.Size(3555,840)
Gui.Form.frame1.Position(180,330)
Gui.Form.frame1.Enabled(True)
Gui.Form.frame1.Visible(True)
Gui.Form.frame1.Zorder(0)
Gui.Form.frame1.Caption("")
Gui.Form.frame1.FontName("Tahoma")
Gui.Form.frame1.FontSize(8.25)
Gui.Form.optRegBOMCompare.Create(Option)
Gui.Form.optRegBOMCompare.Size(2070,255)
Gui.Form.optRegBOMCompare.Position(180,165)
Gui.Form.optRegBOMCompare.Parent("frame1")
Gui.Form.optRegBOMCompare.Caption("Regular BOM compare")
Gui.Form.optRegBOMCompare.Enabled(True)
Gui.Form.optRegBOMCompare.Visible(True)
Gui.Form.optRegBOMCompare.Zorder(0)
Gui.Form.optRegBOMCompare.FontName("Tahoma")
Gui.Form.optRegBOMCompare.FontSize(8.25)
Gui.Form.optCusBOMCompare.Create(Option)
Gui.Form.optCusBOMCompare.Size(2805,255)
Gui.Form.optCusBOMCompare.Position(180,510)
Gui.Form.optCusBOMCompare.Parent("frame1")
Gui.Form.optCusBOMCompare.Caption("Custom assigned BOM category")
Gui.Form.optCusBOMCompare.Enabled(True)
Gui.Form.optCusBOMCompare.Visible(True)
Gui.Form.optCusBOMCompare.Zorder(0)
Gui.Form.optCusBOMCompare.FontName("Tahoma")
Gui.Form.optCusBOMCompare.FontSize(8.25)
Gui.Form.lbl1.Create(Label,"Select how to proceed BOM compare and close (X)",True,4695,195,0,195,90,True,0,"Tahoma",8.25,,0,1)
Gui.Form.lbl1.BorderStyle(0)
Program.Sub.ScreenSU.End

Program.Sub.Preflight.Start
V.Global.bAlt1.Declare
V.Global.bAlt2.Declare
V.Global.bExtDesc.Declare
V.Global.bRouter.Declare
V.Global.bSel.Declare
V.Global.bVendor.Declare
v.Global.bLongPart.Declare
V.Global.bLongMfgXref.Declare

V.Global.bSel.Set(False)
Program.Sub.Preflight.End

Program.Sub.Main.Start
V.Local.sRet.Declare
		
f.Intrinsic.Control.CallSub(CheckLongPart)
F.Intrinsic.Control.CallSub(getoptions)

F.Intrinsic.Control.SelectCase(V.Caller.Hook)
	F.Intrinsic.Control.Case(50310)
		gui.Form.optCusBOMCompare.Value(True)
		gui.Form..Show
		gui.Form..WaitForDismiss
		
		'Preload Hook
		'See if the option is active
		F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 0",V.Local.sRet)
		F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
			F.Intrinsic.Control.CallSub(preload)
		F.Intrinsic.Control.EndIf
		
	F.Intrinsic.Control.Case(50311)
		'PreUpload Hook
		'See if the option is active
			F.Data.DataTable.Select("dtOptions","HOOK = 50311 and SEQ = 0",V.Local.sRet)
			F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
				F.Intrinsic.Control.CallSub(preupload)
			F.Intrinsic.Control.EndIf
		
	F.Intrinsic.Control.Case(50312)
		'PostUpload Hook
		'See if the option is active
		
			F.Data.DataTable.Select("dtOptions","HOOK = 50312 and SEQ = 0",V.Local.sRet)
			F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
				F.Intrinsic.Control.CallSub(postupload)
			F.Intrinsic.Control.EndIf
		
	F.Intrinsic.Control.CaseElse
		F.Intrinsic.Control.CallSub(loadoptionsform)
F.Intrinsic.Control.EndSelect

Program.Sub.Main.End

Program.Sub.getOptions.Start
V.Local.bRet.Declare
V.Local.iFor.Declare
V.Local.sRet.Declare

'F.Global.Registry.ReadValue(user,company code,program as string, regid as long, seq as long, field as long, default as any, return as any)
'Program = "GAB_5308"
'Regid = Hook (50310, 50311, 50312)
'Seq = 0 - 100
'field = BVAL or SVAL
'0 - Boolean 
'1 - Long
'2 - Float
'3 - Date
'4 - Time
'5 - String

F.Intrinsic.Control.If(V.DataTable.dtOptions.Exists,=,True)
	F.Data.DataTable.DeleteRow("dtOptions")
	F.Data.DataTable.Close("dtOptions")
F.Intrinsic.Control.EndIf

F.Data.DataTable.Create("dtOptions",True)
F.Data.DataTable.AddColumn("dtOptions","HOOK",Long)
F.Data.DataTable.AddColumn("dtOptions","SEQ",Long)
F.Data.DataTable.AddColumn("dtOptions","BVAL",Boolean)
'F.Data.DataTable.AddColumn("dtOptions","IVAL",Long)
'F.Data.DataTable.AddColumn("dtOptions","FVAL",Float)
F.Data.DataTable.AddColumn("dtOptions","SVAL",String)

'Read Boolean Values for Hook 50310 - add to ubound as options increase
F.Intrinsic.Control.For(V.Local.iFor,0,8,1)
	F.Global.Registry.ReadValue(-1,V.Caller.CompanyCode,"GAB_5308",50310,V.Local.iFor,0,False,V.Local.bRet)
	F.Global.Registry.ReadValue(-1,V.Caller.CompanyCode,"GAB_5308",50310,V.Local.iFor,5,"",V.Local.sRet)
	F.Data.DataTable.AddRow("dtOptions","HOOK",50310,"SEQ",V.Local.iFor,"BVAL",V.Local.bRet,"SVAL",V.Local.sRet)
F.Intrinsic.Control.Next(V.Local.iFor)

'Read Boolean Values for Hook 50311 - add to ubound as options increase
F.Intrinsic.Control.For(V.Local.iFor,0,1,1)
	F.Global.Registry.ReadValue(-1,V.Caller.CompanyCode,"GAB_5308",50311,V.Local.iFor,0,False,V.Local.bRet)
	F.Global.Registry.ReadValue(-1,V.Caller.CompanyCode,"GAB_5308",50311,V.Local.iFor,5,"",V.Local.sRet)
	F.Data.DataTable.AddRow("dtOptions","HOOK",50311,"SEQ",V.Local.iFor,"BVAL",V.Local.bRet,"SVAL",V.Local.sRet)
F.Intrinsic.Control.Next(V.Local.iFor)

'Read Boolean Values for Hook 50312 - add to ubound as options increase
F.Intrinsic.Control.For(V.Local.iFor,0,10,1) 'Modified 8/11/2020 by DD -- Changed Ubound from 9 to 10 for new option MFG Part Approved/Preferred; Modified 3/15/2020 by TCM -- changed ubound from 7 to 9 for 2 new options Inv Vendor Sort and BOM Comments
	F.Global.Registry.ReadValue(-1,V.Caller.CompanyCode,"GAB_5308",50312,V.Local.iFor,0,False,V.Local.bRet)
	F.Global.Registry.ReadValue(-1,V.Caller.CompanyCode,"GAB_5308",50312,V.Local.iFor,5,"",V.Local.sRet)
	F.Data.DataTable.AddRow("dtOptions","HOOK",50312,"SEQ",V.Local.iFor,"BVAL",V.Local.bRet,"SVAL",V.Local.sRet)
F.Intrinsic.Control.Next(V.Local.iFor)
Program.Sub.getOptions.End

Program.Sub.connect.Start
F.ODBC.Connection!conx.OpenConnection(V.Ambient.PDSN,V.Ambient.PUser,V.Ambient.PPass)
Program.Sub.connect.End

Program.Sub.disconnect.Start
F.ODBC.Connection!conx.Close
Program.Sub.disconnect.End

Program.Sub.preLoad.Start
V.Local.bInstr.Declare
V.Local.bOnFirst.Declare
V.Local.bSource.Declare
V.Local.iTitles.Declare
V.Local.iFor.Declare
V.Local.iFor2.Declare
V.Local.iLen.Declare
V.Local.iRows.Declare
V.Local.sChild.Declare
V.Local.sGSSPart.Declare
V.Local.sParent.Declare
V.Local.sRet.Declare
V.Local.sRow.Declare
V.Local.sSel.Declare
V.Local.sSQL.Declare
V.Local.sTitleArray.Declare
V.Local.sTitles.Declare

'Connect
F.Intrinsic.Control.CallSub(connect)

F.Intrinsic.UI.InvokeWaitDialog("Loading BDF","BOM Compare - ARC 5308 - Ver: 081720201116")

'Close dtPreload if it exists
F.Intrinsic.Control.If(V.DataTable.dtPreload.Exists,=,True)
	F.Data.DataTable.DeleteRow("dtPreload")
	F.Data.DataTable.Close("dtPreload")
F.Intrinsic.Control.EndIf

'Load the BDF to dtPreLoad
F.Intrinsic.BDF.Load("bdfPreload","Main-PrePopulate-bdf")

'Load the BDF Titles
F.Intrinsic.BDF.ReadColumnTitle("bdfPreload",V.Local.sTitles)

'Split the titles and loop through them to create columns in dtPreload
F.Intrinsic.String.Split(V.Local.sTitles,"*!*",V.Local.sTitleArray)
F.Data.DataTable.Create("dtPreload",True)
V.Local.iTitles.Set(V.Local.sTitleArray.UBound)
F.Intrinsic.Control.For(V.Local.iFor,0,V.Local.iTitles,1)
	F.Intrinsic.UI.ChangeWaitStatus("Creating Data Table",V.Local.iFor,0,V.Local.iTitles)
	F.Data.DataTable.AddColumn("dtPreload",V.Local.sTitleArray(V.Local.iFor).UCase,"String")
F.Intrinsic.Control.Next(V.Local.iFor)

'Check for Alt Desc 1 and 2
F.Intrinsic.String.IsInString(V.Local.sTitles,"ALT_DESC_1",True,V.Global.bAlt1)
F.Intrinsic.String.IsInString(V.Local.sTitles,"ALT_DESC_2",True,V.Global.bAlt2)
F.Intrinsic.String.IsInString(V.Local.sTitles,"EXT_DESCRIPTION",True,V.Global.bExtDesc)
F.Intrinsic.String.IsInString(V.Local.sTitles,"ROUTER",True,V.Global.bRouter)
F.Intrinsic.String.IsInString(V.Local.sTitles,"VENDOR_CODE",True,V.Global.bVendor)

'Load the bdf rows into dtPreload
F.Intrinsic.BDF.ReadRowCount("bdfPreload",V.Local.iRows)
F.Intrinsic.Math.Sub(V.Local.iRows,1,V.Local.iRows)
F.Intrinsic.Control.For(V.Local.iFor,0,V.Local.iRows,1)
	F.Intrinsic.UI.ChangeWaitStatus("Loading BDF to Data Table",V.Local.iFor,0,V.Local.iRows)
	F.Intrinsic.BDF.ReadRow("bdfPreload",V.Local.iFor,V.Local.sRow)
	F.Intrinsic.String.Split(V.Local.sRow,"|~|",V.Local.sRow)
	V.Local.bOnFirst.Set(False)
	F.Intrinsic.Control.For(V.Local.iFor2,0,V.Local.iTitles,1)
		F.Intrinsic.Control.If(V.Local.bOnFirst,=,False)
			F.Data.DataTable.AddRow("dtPreload",V.Local.sTitleArray(V.Local.iFor2),V.Local.sRow(V.Local.iFor2))
		F.Intrinsic.Control.Else
			F.Data.DataTable.SetValue("dtPreload",V.Local.iFor,V.Local.sTitleArray(V.Local.iFor2),V.Local.sRow(V.Local.iFor2))
		F.Intrinsic.Control.EndIf
		V.Local.bOnFirst.Set(True)
	F.Intrinsic.Control.Next(V.Local.iFor2)
F.Intrinsic.Control.Next(V.Local.iFor)

'See if default source is checked
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 1",V.Local.sRet)
V.Local.bSource.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldValTrim)

'Get the default values for parents and children
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 2",V.Local.sRet)
V.Local.sParent.Set(V.DataTable.dtOptions(V.Local.sRet).SVAL!FieldValTrim)
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 3",V.Local.sRet)
V.Local.sChild.Set(V.DataTable.dtOptions(V.Local.sRet).SVAL!FieldValTrim)

'Loop through dtPreLoad
F.Intrinsic.Control.For(V.Local.iFor,0,V.DataTable.dtPreload.RowCount--,1)
	F.Intrinsic.String.GSSPartString(V.DataTable.dtPreload(V.Local.iFor).PartNo!FieldValTrim,V.DataTable.dtPreload(V.Local.iFor).Revision!FieldValTrim,V.Local.sGSSPart)
	F.Intrinsic.String.Trim(V.Local.sGSSPart,V.Local.sGSSPart)
	F.Intrinsic.Control.If(V.Local.bSource,=,True)
		'Set default source in the data table if source is blank
		F.Intrinsic.Control.If(V.DataTable.dtPreload(V.Local.iFor).Source!FieldValTrim,=,"")
			F.Intrinsic.String.Build("[PARENT] = '{0}'",V.DataTable.dtPreload(V.Local.iFor).PARTNO!FieldValTrim,V.Local.sSel)
			F.Data.DataTable.Select("dtPreload",V.Local.sSel,V.Local.sRet)
			F.Intrinsic.Control.If(V.Local.sRet,=,"***NORETURN***")
				'It's not a parent so it is a child
				F.Data.DataTable.SetValue("dtPreload",V.Local.iFor,"SOURCE",V.Local.sChild)
			F.Intrinsic.Control.Else
				'It's a parent so use the default for parent
				F.Data.DataTable.SetValue("dtPreload",V.Local.iFor,"SOURCE",V.Local.sParent)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.Next(V.Local.iFor)

'Check for the preview screen
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 4",V.Local.sRet)
F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
	F.Intrinsic.Control.CallSub(loadfmain)
F.Intrinsic.Control.Else
	F.Intrinsic.Control.CallSub(savepreloadbdf)
F.Intrinsic.Control.EndIf
Program.Sub.preLoad.End

Program.Sub.preUpload.Start
V.Local.bExists.Declare
V.Local.bInstr.Declare
V.Local.bRouter.Declare
V.Local.bOnFirst.Declare
V.Local.iFor.Declare
V.Local.iFor2.Declare
V.Local.iLen.Declare
V.Local.iRows.Declare
V.Local.iTitles.Declare
V.Local.sGSSPart.Declare
V.Local.sRange.Declare
V.Local.sRet.Declare
V.Local.sRouter.Declare
V.Local.sRow.Declare
V.Local.sSQL.Declare
V.Local.sTitleArray.Declare
V.Local.sTitles.Declare
'Added 3/15/2020 by TCM -- Add BOM Comments
v.Local.sSequence.Declare
v.Local.iBomCommentsCount.Declare
v.Local.sFieldNames.Declare
v.Local.bRouterInFieldNames.Declare
v.Local.sGSSParentPart.Declare

'Connect
F.Intrinsic.Control.CallSub(connect)

F.Intrinsic.UI.InvokeWaitDialog("Loading BDF","BOM Compare - ARC 5308 - Ver: 081720201116")

'Close dtPreUpload if it exists
F.Intrinsic.Control.If(V.DataTable.dtPreUpload.Exists,=,True)
	F.Data.DataTable.DeleteRow("dtPreUpload")
	F.Data.DataTable.Close("dtPreUpload")
F.Intrinsic.Control.EndIf

'Load the BDF to dtPreUpload
F.Intrinsic.BDF.Load("bdfPreUpload","Main-PreProcessCompleteData-ReadOnly-bdf")

'F.Intrinsic.BDF.Load("bdfPreUpload","Main-PreProcessData-bdf")

'Load the BDF Titles

F.Intrinsic.BDF.ReadColumnTitle("bdfPreUpload",V.Local.sTitles)

'Split the titles and loop through them to create columns in dtPreUpload
F.Intrinsic.String.Split(V.Local.sTitles,"*!*",V.Local.sTitleArray)
F.Data.DataTable.Create("dtPreUpload",True)
V.Local.iTitles.Set(V.Local.sTitleArray.UBound)
F.Intrinsic.Control.For(V.Local.iFor,0,V.Local.iTitles,1)
	F.Intrinsic.UI.ChangeWaitStatus("Creating Data Table",V.Local.iFor,0,V.Local.iTitles)
	F.Data.DataTable.AddColumn("dtPreUpload",V.Local.sTitleArray(V.Local.iFor),"String")
F.Intrinsic.Control.Next(V.Local.iFor)

'Check for ROUTER
'THERE'S NOTHING TO EVER SET THIS TO TRUE???
F.Intrinsic.Control.If(V.Local.bRouter,=,True)
	F.Intrinsic.String.IsInString(V.Local.sTitles.UCase,"ROUTER",True,V.Local.bInstr)
	F.Intrinsic.Control.If(V.Local.bInstr,=,False)
		'F.Data.DataTable.AddColumn("dtPreUpload","ROUTER","String")
		F.Intrinsic.UI.Msgbox("ROUTER column does not exist!  Add column and try again.","BOM Compare - ARC 5308 - Ver: 081720201116")
		F.Intrinsic.Control.End
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf

'Function.Intrinsic.Debug.InvokeDebugger

'Load the bdf rows into dtPreUpload
F.Intrinsic.BDF.ReadRowCount("bdfPreUpload",V.Local.iRows)
F.Intrinsic.Math.Sub(V.Local.iRows,1,V.Local.iRows)
F.Intrinsic.Control.For(V.Local.iFor,0,V.Local.iRows,1)
	F.Intrinsic.UI.ChangeWaitStatus("Loading BDF to Data Table",V.Local.iFor,0,V.Local.iRows)
	F.Intrinsic.BDF.ReadRow("bdfPreUpload",V.Local.iFor,V.Local.sRow)
	F.Intrinsic.String.Split(V.Local.sRow,"|~|",V.Local.sRow)
	V.Local.bOnFirst.Set(False)
	F.Intrinsic.Control.For(V.Local.iFor2,0,V.Local.iTitles,1)
		F.Intrinsic.Control.If(V.Local.bOnFirst,=,False)
			F.Data.DataTable.AddRow("dtPreUpload",V.Local.sTitleArray(V.Local.iFor2),V.Local.sRow(V.Local.iFor2))
		F.Intrinsic.Control.Else
			F.Data.DataTable.SetValue("dtPreUpload",V.Local.iFor,V.Local.sTitleArray(V.Local.iFor2),V.Local.sRow(V.Local.iFor2))
		F.Intrinsic.Control.EndIf
		V.Local.bOnFirst.Set(True)
	F.Intrinsic.Control.Next(V.Local.iFor2)
F.Intrinsic.Control.Next(V.Local.iFor)

'Had to add this to make sure they have router in their fields list before we try and use it
v.Local.sFieldNames.Set(V.DataTable.dtPreUpload.FieldNames)
f.Intrinsic.String.IsInString(v.Local.sFieldNames.UCase,"ROUTER",TRUE,V.Local.bRouterInFieldNames)

F.Data.DataTable.Select("dtOptions","HOOK = 50311 and SEQ = 1",V.Local.sRet)
F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
'3/15/2020 - Commented this out because the new version of BOM compare is not using this passed variable since we got rid of the "Create Routers" button
'F.Intrinsic.Control.AndIf(V.Passed.Main-chkCreateRouter-v,=,True)
F.Intrinsic.Control.AndIf(V.Local.bRouterInFieldNames)
	F.Intrinsic.Control.If(V.DataTable.dtRouter.Exists,=,False)
		F.Data.DataTable.Create("dtRouter",True)
	F.Intrinsic.Control.Else
		F.Data.DataTable.DeleteRow("dtRouter")
	F.Intrinsic.Control.EndIf

	F.Intrinsic.UI.InvokeWaitDialog("Uploading Routers","BOM Compare - ARC 5308 - Ver: 081720201116")

	F.Intrinsic.Control.For(V.Local.iFor,0,V.DataTable.dtPreUpload.RowCount--,1)
		F.Intrinsic.UI.ChangeWaitStatus("Uploading Routers",V.Local.iFor,0,V.DataTable.dtPreUpload.RowCount--)
		F.Intrinsic.Control.If(V.DataTable.dtPreUpload(V.Local.iFor).Router!FieldValTrim,<>,"")
			'Check to see if the router already exists
			F.Intrinsic.String.GSSPartString(V.DataTable.dtPreUpload(V.Local.iFor).PartNo!FieldValTrim,V.DataTable.dtPreUpload(V.Local.iFor).Revision!FieldValTrim,V.Local.sGSSPart)
			F.Intrinsic.String.Build("select * from V_ROUTER_LINE where ROUTER = '{0}'",V.Local.sGSSPart.Trim,V.Local.sSQL)
			F.ODBC.Connection!conx.OpenLocalRecordsetRO("rstSel",V.Local.sSQL)
			F.Intrinsic.Control.If(V.ODBC.conx!rstSel.EOF,=,False)
				V.Local.bExists.Set(True)
			F.Intrinsic.Control.Else
				V.Local.bExists.Set(False)
			F.Intrinsic.Control.EndIf
			F.ODBC.conx!rstSel.Close
			F.Intrinsic.Control.If(V.Local.bExists,=,False)
				F.Intrinsic.Control.CallSub(loaddtrouter,"Row",V.Local.iFor,"Router",V.DataTable.dtPreUpload(V.Local.iFor).Router!FieldValTrim,"Target",V.Local.sGSSPart.Trim)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Next(V.Local.iFor)

	F.Intrinsic.Control.If(V.DataTable.dtRouter.RowCount,>,0)
		F.Intrinsic.Control.CallSub(uploadrouters)
		F.Intrinsic.Control.CallSub(addroutercomments)
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.CallSub(unload)
Program.Sub.preUpload.End

Program.Sub.postUpload.Start
V.Local.bAlt.Declare
V.Local.bBin.Declare
V.Local.bCustomer.Declare
V.Local.bExtra.Declare
V.Local.bInstr.Declare
V.Local.bLoop.Declare
V.Local.bOnFirst.Declare
V.Local.bRebuild.Declare
V.Local.bVendor.Declare
V.Local.iTitles.Declare
V.Local.iFor.Declare
V.Local.iFor2.Declare
V.Local.iLen.Declare
V.Local.iRows.Declare
V.Local.sGSSPart.Declare
V.Local.sParents.Declare
V.Local.sRange.Declare
V.Local.sRet.Declare
V.Local.sRow.Declare
V.Local.sSel.Declare
V.Local.sSQL.Declare
V.Local.sTitleArray.Declare
V.Local.sTitles.Declare
'ADDED 3/15/2020 BY TCM -- VENDOR SORT AND BOM COMMENTS
V.Local.bVendorSort.Declare
v.Local.bBOMComments.Declare
v.Local.sSequence.Declare
v.Local.iBomCommentsCount.Declare
v.Local.sBOMComments.Declare
'ADDED 8/11/2020 BY DD -- BOM APPROVED AND PREFERRED
v.Local.bBOMApprPref.Declare
v.Local.sError.Declare
v.Local.sMfgPart.Declare
v.Local.sMfgName.Declare
'ADD 10/7/2020 BY DD -- SUPPORT FOR LONG PART MFG XREF
v.Local.sLPartMfgXref.Declare
v.Local.iLpartMfgXrefLen.Declare
v.Local.sLPartMfgXrefSeq.Declare(String,"001")
v.Local.iLpartSeqCnt.Declare
v.Local.sMfgPartOriginal.Declare

'Connect
F.Intrinsic.Control.CallSub(connect)

F.Intrinsic.UI.InvokeWaitDialog("Loading BDF","BOM Compare - ARC 5308 - Ver: 090220201203")

'Close dtPostUpload if it exists
F.Intrinsic.Control.If(V.DataTable.dtPostUpload.Exists,=,True)
	F.Data.DataTable.DeleteRow("dtPostUpload")
	F.Data.DataTable.Close("dtPostUpload")
F.Intrinsic.Control.EndIf

'Load the BDF to dtPreLoad
F.Intrinsic.BDF.Load("bdfPostUpload","Main-PostProcessCompleteData-ReadOnly-bdf")
'F.Intrinsic.BDF.Load("bdfPostUpload","Main-PostProcessData-bdf")

'Load the BDF Titles
F.Intrinsic.BDF.ReadColumnTitle("bdfPostUpload",V.Local.sTitles)

'Split the titles and loop through them to create columns in dtPreload
F.Intrinsic.String.Split(V.Local.sTitles,"*!*",V.Local.sTitleArray)
F.Data.DataTable.Create("dtPostUpload",True)
V.Local.iTitles.Set(V.Local.sTitleArray.UBound)
F.Intrinsic.Control.For(V.Local.iFor,0,V.Local.iTitles,1)
	F.Intrinsic.UI.ChangeWaitStatus("Creating Data Table",V.Local.iFor,0,V.Local.iTitles)
	F.Data.DataTable.AddColumn("dtPostUpload",V.Local.sTitleArray(V.Local.iFor).UCase,"String")
F.Intrinsic.Control.Next(V.Local.iFor)

'Check for VENDOR_CODE, MFR_PART_NO, MFR_NAME, CUSTOMER, CUSTOMER_PART, AltDescription1, AltDescription2, DEFAULT_BIN
F.Intrinsic.String.IsInString(V.Local.sTitles,"VENDOR_CODE",True,V.Local.bInstr)
F.Intrinsic.Control.If(V.Local.bInstr,=,False)
	F.Data.DataTable.AddColumn("dtPostUpload","VENDOR_CODE","String")
F.Intrinsic.Control.EndIf
F.Intrinsic.String.IsInString(V.Local.sTitles,"MFR_PART_NO",True,V.Local.bInstr)
F.Intrinsic.Control.If(V.Local.bInstr,=,False)
	F.Data.DataTable.AddColumn("dtPostUpload","MFR_PART_NO","String")
F.Intrinsic.Control.EndIf
F.Intrinsic.String.IsInString(V.Local.sTitles,"MFR_NAME",True,V.Local.bInstr)
F.Intrinsic.Control.If(V.Local.bInstr,=,False)
	F.Data.DataTable.AddColumn("dtPostUpload","MFR_NAME","String")
F.Intrinsic.Control.EndIf
F.Intrinsic.String.IsInString(V.Local.sTitles,"CUSTOMER",True,V.Local.bInstr)
F.Intrinsic.Control.If(V.Local.bInstr,=,False)
	F.Data.DataTable.AddColumn("dtPostUpload","CUSTOMER","String")
F.Intrinsic.Control.EndIf
F.Intrinsic.String.IsInString(V.Local.sTitles,"CUSTOMER_PART",True,V.Local.bInstr)
F.Intrinsic.Control.If(V.Local.bInstr,=,False)
	F.Data.DataTable.AddColumn("dtPostUpload","CUSTOMER_PART","String")
F.Intrinsic.Control.EndIf
F.Intrinsic.String.IsInString(V.Local.sTitles,"AltDescription1",True,V.Local.bInstr)
F.Intrinsic.Control.If(V.Local.bInstr,=,False)
	F.Data.DataTable.AddColumn("dtPostUpload","AltDescription1","String")
F.Intrinsic.Control.EndIf
F.Intrinsic.String.IsInString(V.Local.sTitles,"AltDescription2",True,V.Local.bInstr)
F.Intrinsic.Control.If(V.Local.bInstr,=,False)
	F.Data.DataTable.AddColumn("dtPostUpload","AltDescription2","String")
F.Intrinsic.Control.EndIf
'DD - 9/11/2020 - Extra Description is now a core field in BOM Compare
'F.Intrinsic.String.IsInString(V.Local.sTitles,"DescExtra",True,V.Local.bInstr)
'F.Intrinsic.Control.If(V.Local.bInstr,=,False)
'	'F.Data.DataTable.AddColumn("dtPostUpload","EXT_DESCRIPTION","String")
'	F.Data.DataTable.AddColumn("dtPostUpload","DescExtra","String")
'F.Intrinsic.Control.EndIf
F.Intrinsic.String.IsInString(V.Local.sTitles,"DEFAULT_BIN",True,V.Local.bInstr)
F.Intrinsic.Control.If(V.Local.bInstr,=,False)
	F.Data.DataTable.AddColumn("dtPostUpload","DEFAULT_BIN","String")
F.Intrinsic.Control.EndIf
F.Intrinsic.String.IsInString(V.Local.sTitles,"VENDOR_SORT",True,V.Local.bInstr)
F.Intrinsic.Control.If(V.Local.bInstr,=,False)
	F.Data.DataTable.AddColumn("dtPostUpload","VENDOR_SORT","String")
F.Intrinsic.Control.EndIf
F.Intrinsic.String.IsInString(V.Local.sTitles,"BOM_COMMENTS",True,V.Local.bInstr)
F.Intrinsic.Control.If(V.Local.bInstr,=,False)
	F.Data.DataTable.AddColumn("dtPostUpload","BOM_COMMENTS","String")
F.Intrinsic.Control.EndIf
F.Intrinsic.String.IsInString(V.Local.sTitles,"APPROVED",True,V.Local.bInstr)
F.Intrinsic.Control.If(V.Local.bInstr,=,False)
	F.Data.DataTable.AddColumn("dtPostUpload","APPROVED","String")
F.Intrinsic.Control.EndIf
F.Intrinsic.String.IsInString(V.Local.sTitles,"PREFERRED",True,V.Local.bInstr)
F.Intrinsic.Control.If(V.Local.bInstr,=,False)
	F.Data.DataTable.AddColumn("dtPostUpload","PREFERRED","String")
F.Intrinsic.Control.EndIf


'Load the bdf rows into dtPostUpload
F.Intrinsic.BDF.ReadRowCount("bdfPostUpload",V.Local.iRows)
F.Intrinsic.Math.Sub(V.Local.iRows,1,V.Local.iRows)
F.Intrinsic.Control.For(V.Local.iFor,0,V.Local.iRows,1)
	F.Intrinsic.UI.ChangeWaitStatus("Loading BDF to Data Table",V.Local.iFor,0,V.Local.iRows)
	F.Intrinsic.BDF.ReadRow("bdfPostUpload",V.Local.iFor,V.Local.sRow)
	F.Intrinsic.String.Split(V.Local.sRow,"|~|",V.Local.sRow)
	V.Local.bOnFirst.Set(False)
	F.Intrinsic.Control.For(V.Local.iFor2,0,V.Local.iTitles,1)
		F.Intrinsic.Control.If(V.Local.bOnFirst,=,False)
			F.Data.DataTable.AddRow("dtPostUpload",V.Local.sTitleArray(V.Local.iFor2),V.Local.sRow(V.Local.iFor2))
		F.Intrinsic.Control.Else
			F.Data.DataTable.SetValue("dtPostUpload",V.Local.iFor,V.Local.sTitleArray(V.Local.iFor2),V.Local.sRow(V.Local.iFor2))
		F.Intrinsic.Control.EndIf
		V.Local.bOnFirst.Set(True)
	F.Intrinsic.Control.Next(V.Local.iFor2)
F.Intrinsic.Control.Next(V.Local.iFor)

'Loop through dtPostUpload if any of 1,2,3,4,6, or 7 are active
'Get the options
V.Local.bLoop.Set(False)
F.Data.DataTable.Select("dtOptions","HOOK = 50312 and SEQ = 1",V.Local.sRet)
F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
	V.Local.bVendor.Set(True)
	V.Local.bLoop.Set(True)
F.Intrinsic.Control.EndIf
F.Data.DataTable.Select("dtOptions","HOOK = 50312 and SEQ = 2",V.Local.sRet)
F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
	V.Local.bCustomer.Set(True)
	V.Local.bLoop.Set(True)
F.Intrinsic.Control.EndIf
F.Data.DataTable.Select("dtOptions","HOOK = 50312 and SEQ = 3",V.Local.sRet)
F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
	V.Local.bAlt.Set(True)
	V.Local.bLoop.Set(True)
F.Intrinsic.Control.EndIf
F.Data.DataTable.Select("dtOptions","HOOK = 50312 and SEQ = 4",V.Local.sRet)
F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
	V.Local.bExtra.Set(True)
	V.Local.bLoop.Set(True)
F.Intrinsic.Control.EndIf
F.Data.DataTable.Select("dtOptions","HOOK = 50312 and SEQ = 6",V.Local.sRet)
F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
	V.Local.bRebuild.Set(True)
	V.Local.bLoop.Set(True)
F.Intrinsic.Control.EndIf
F.Data.DataTable.Select("dtOptions","HOOK = 50312 and SEQ = 7",V.Local.sRet)
F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
	V.Local.bBin.Set(True)
	V.Local.bLoop.Set(True)
F.Intrinsic.Control.EndIf
'ADDED 3/15/2020 BY TCM -- VENDOR SORT AND BOM COMMENTS
'INV VENDOR SORT
F.Data.DataTable.Select("dtOptions","HOOK = 50312 and SEQ = 8",V.Local.sRet)
F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
	V.Local.bVendorSort.Set(True)
	V.Local.bLoop.Set(True)
F.Intrinsic.Control.EndIf
'BOM COMMENTS
F.Data.DataTable.Select("dtOptions","HOOK = 50312 and SEQ = 9",V.Local.sRet)
F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
	V.Local.bBOMComments.Set(True)
	V.Local.bLoop.Set(True)
F.Intrinsic.Control.EndIf
'APPROVED & PREFERRED
F.Data.DataTable.Select("dtOptions","HOOK = 50312 and SEQ = 10",V.Local.sRet)
F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
	V.Local.bBOMApprPref.Set(True)
	V.Local.bLoop.Set(True)
	
	'Create datatable to store results that need to be saved
	f.Data.DataTable.CreateFromSQL("dtBOMXref","conx","select * from bom_xref where 1=0")
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.If(V.Local.bLoop,=,True)
	F.Intrinsic.Control.For(V.Local.iFor,0,V.DataTable.dtPostUpload.RowCount--,1)
		F.Intrinsic.String.GSSPartString(V.DataTable.dtPostUpload(V.Local.iFor).PARTNO!FieldValTrim,V.DataTable.dtPostUpload(V.Local.iFor).REVISION!FieldValTrim,V.Local.sGSSPart)
		F.Intrinsic.String.Trim(V.Local.sGSSPart,V.Local.sGSSPart)
		F.Intrinsic.Control.if(V.Local.bVendor,=,True)
			F.Intrinsic.Control.If(V.DataTable.dtPostUpload(V.Local.iFor).MFR_PART_NO!FieldValTrim,<>,"")			
				f.Intrinsic.Control.Try
					'Make all incoming xrefs upper case
					f.Intrinsic.String.UCase(V.DataTable.dtPostUpload(V.Local.iFor).MFR_PART_NO!FieldValTrim,v.Local.sMfgPart)
					f.Intrinsic.String.UCase(V.DataTable.dtPostUpload(V.Local.iFor).MFR_NAME!FieldValTrim,v.Local.sMfgName)
					
					'Check if long mfg xref is used.  Build the long xref and the short xref if needed.
					f.Intrinsic.Control.If(v.Global.bLongMfgXref)
						f.Intrinsic.String.Len(v.Local.sMfgPart,v.Local.iLpartMfgXrefLen)
						f.Intrinsic.Control.If(v.Local.iLpartMfgXrefLen,>,18)
							v.Local.sLPartMfgXref.Set(v.Local.sMfgPart)
							f.Intrinsic.String.Left(v.Local.sLPartMfgXref,18,v.Local.sMfgPartOriginal)
							f.Intrinsic.String.Build("{0}{1}||",v.Local.sMfgPartOriginal,v.Local.sLPartMfgXrefSeq,v.Local.sMfgPart)
							v.Local.sRet.Set("")
							'Check to see if the short version of the mfg part has already been used with another long mfg part.  If so, use the next sequence.
							'f.Intrinsic.Control.DoUntil(v.Local.sRet,=,"")
								f.Intrinsic.String.Build("select part from v_lpart_mfg_xref where part='{0}';",v.Local.sMfgPart,v.Local.sSQL)
								f.ODBC.Connection!conx.ExecuteAndReturn(v.Local.sSQL,v.Local.sRet)
								f.Intrinsic.Control.If(v.Local.sRet,!=,"")
									'See what the next available short part would be
									f.Intrinsic.String.Build("select top 1 left(part,21) from v_lpart_mfg_xref where part like '{0}%' order by part desc",v.Local.sMfgPartOriginal,v.Local.sSQL)
									f.ODBC.Connection!conx.ExecuteAndReturn(v.Local.sSQL,v.Local.sRet)
									
									f.Intrinsic.Control.If(v.Local.sRet,!=,"")
										f.Intrinsic.String.Right(v.Local.sRet,3,v.Local.sLPartMfgXrefSeq)
										f.Intrinsic.Math.Add(v.Local.sLPartMfgXrefSeq.Long,1,v.Local.sLPartMfgXrefSeq)
										f.Intrinsic.String.Format(v.Local.sLPartMfgXrefSeq,"0000",v.Local.sLPartMfgXrefSeq)
									f.Intrinsic.Control.EndIf
									
									f.Intrinsic.String.Build("{0}{1}||",v.Local.sMfgPartOriginal,v.Local.sLPartMfgXrefSeq,v.Local.sMfgPart)
									f.Intrinsic.String.Build("insert into lpart_mfg_xref (part, long_part) values ('{0}', '{1}');",v.Local.sMfgPart,v.Local.sLPartMfgXref,v.Local.sSQL)
									f.ODBC.Connection!conx.Execute(v.local.sSQL)
								f.Intrinsic.Control.EndIf
						f.Intrinsic.Control.EndIf
					f.Intrinsic.Control.Else
						f.Intrinsic.String.Left(v.Local.sMfgPart,23,v.Local.sMfgPart)
						f.Intrinsic.String.Left(v.Local.sMfgName,23,v.Local.sMfgName)
					f.Intrinsic.Control.EndIf
					
					F.Intrinsic.String.Build("select * from INV_CROSS_REF where PART = '{0}' and VENDOR = '{1}' and MFG_PART = '{2}'",V.Local.sGSSPart.UCase,V.DataTable.dtPostUpload(V.Local.iFor).VENDOR_CODE!FieldValTrim,v.Local.sMfgPart,V.Local.sSQL)
					f.Data.DataTable.CreateFromSQL("dtVendorXref","conx",v.Local.sSQL)
					
					f.Intrinsic.Control.If(v.DataTable.dtVendorXref.RowCount,>,0)
						f.Intrinsic.Control.If(v.DataTable.dtVendorXref(0).MFG_NAME!FieldValTrim,<>,v.Local.sMfgName)
							F.Intrinsic.String.Build("DELETE FROM INV_CROSS_REF WHERE PART='{0}' AND MFG_PART='{1}' AND MFG_NAME='{2}' AND VENDOR='{3}'",V.Local.sGSSPart.UCase,v.Local.sMfgPart,v.Local.sMfgName,V.DataTable.dtPostUpload(V.Local.iFor).VENDOR_CODE!FieldValTrim,v.Local.sSQL)
							f.ODBC.Connection!conx.execute(v.Local.sSQL)
							f.Data.DataTable.DeleteRow("dtVendorXref")
						f.Intrinsic.Control.EndIf
					F.Intrinsic.Control.EndIf
					
					f.Intrinsic.Control.If(v.DataTable.dtVendorXref.RowCount,=,0)
						f.Intrinsic.String.Build("insert into inv_cross_ref (part, vendor, mfg_part, mfg_name) values ('{0}', '{1}', '{2}', '{3}');",v.Local.sGSSPart, V.DataTable.dtPostUpload(V.Local.iFor).VENDOR_CODE!FieldValTrim, v.Local.sMfgPart, v.Local.sMfgName,v.Local.sSQL)
						f.ODBC.Connection!conx.execute(v.Local.sSQL)
					F.Intrinsic.Control.EndIf
				f.Intrinsic.Control.Catch	
					f.Intrinsic.String.Build("Project GAB_5308_BOM_Compare.g2u {0}{0}Subroutine: {1}{0}Error: {2} with Description: {3}", v.Ambient.NewLine, "PostUpload", v.Ambient.ErrorNumber, v.Ambient.ErrorDescription, v.Local.sError)
					f.Intrinsic.UI.Msgbox(v.Local.sError)
				f.Intrinsic.Control.Finally
					F.Intrinsic.Control.If(V.DataTable.dtVendorXref.Exists,=,True)
						F.Data.DataTable.Close("dtVendorXref")
					F.Intrinsic.Control.EndIf
				f.Intrinsic.Control.EndTry			
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.If(V.Local.bCustomer,=,True)
			F.Intrinsic.Control.If(V.DataTable.dtPostUpload(V.Local.iFor).CUSTOMER_PART!FieldValTrim,<>,"")
				F.Intrinsic.String.Build("select * from INV_CROSS_REF where PART = '{0}' and CUSTOMER = '{1}' and CUSTOMER_PART = '{2}'",V.Local.sGSSPart,V.DataTable.dtPostUpload(V.Local.iFor).CUSTOMER!FieldValTrim,V.DataTable.dtPostUpload(V.Local.iFor).CUSTOMER_PART!FieldValTrim,V.Local.sSQL)
				F.ODBC.Connection!conx.OpenLocalRecordsetRW("rstUpdate",V.Local.sSQL)
				F.Intrinsic.Control.If(V.ODBC.conx!rstUpdate.EOF,=,True)
					F.ODBC.conx!rstUpdate.AddNew
					F.ODBC.conx!rstUpdate.Set!PART(V.Local.sGSSPart)
					F.ODBC.conx!rstUpdate.Set!CUSTOMER(V.DataTable.dtPostUpload(V.Local.iFor).CUSTOMER!FieldValTrim)
					F.ODBC.conx!rstUpdate.Set!CUSTOMER_PART(V.DataTable.dtPostUpload(V.Local.iFor).CUSTOMER_PART!FieldValTrim)
					F.ODBC.conx!rstUpdate.Update
				F.Intrinsic.Control.EndIf
				F.ODBC.conx!rstUpdate.Close
			F.Intrinsic.Control.EndIf		
		F.Intrinsic.Control.EndIf
		
		F.Intrinsic.Control.If(V.Local.bAlt,=,True)
			F.Intrinsic.Control.If(V.DataTable.dtPostUpload(V.Local.iFor).AltDescription1!FieldValTrim,<>,"")
				F.Intrinsic.String.Build("select * from INVENTORY_MST2 where PART = '{0}'",V.Local.sGSSPart,V.Local.sSQL)
				F.ODBC.Connection!conx.OpenLocalRecordsetRW("rstUpdate",V.Local.sSQL)
				F.Intrinsic.Control.If(V.ODBC.conx!rstUpdate.EOF,=,False)
					F.ODBC.conx!rstUpdate.Set!DESCRIPTION_2(V.DataTable.dtPostUpload(V.Local.iFor).AltDescription1!FieldValTrim)
					F.ODBC.conx!rstUpdate.Update
				F.Intrinsic.Control.EndIf
				F.ODBC.conx!rstUpdate.Close
			F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.If(V.DataTable.dtPostUpload(V.Local.iFor).AltDescription2!FieldValTrim,<>,"")
				F.Intrinsic.String.Build("select * from INVENTORY_MST2 where PART = '{0}'",V.Local.sGSSPart,V.Local.sSQL)
				F.ODBC.Connection!conx.OpenLocalRecordsetRW("rstUpdate",V.Local.sSQL)
				F.Intrinsic.Control.If(V.ODBC.conx!rstUpdate.EOF,=,False)
					F.ODBC.conx!rstUpdate.Set!DESCRIPTION_3(V.DataTable.dtPostUpload(V.Local.iFor).AltDescription2!FieldValTrim)
					F.ODBC.conx!rstUpdate.Update
				F.Intrinsic.Control.EndIf
				F.ODBC.conx!rstUpdate.Close
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
		'DD - 9/11/2020 - Extra Description is now a core field in BOM Compare
'		F.Intrinsic.Control.If(V.Local.bExtra,=,True)
'			F.Intrinsic.Control.If(V.DataTable.dtPostUpload(V.Local.iFor).DescExtra!FieldValTrim,<>,"")
'				F.Intrinsic.String.Build("select * from INV_EXTRA_TEXT where PART = '{0}'",V.Local.sGSSPart,V.Local.sSQL)
'				F.ODBC.Connection!conx.OpenLocalRecordsetRW("rstUpdate",V.Local.sSQL)
'				F.Intrinsic.Control.If(V.ODBC.conx!rstUpdate.EOF,=,True)
'					F.ODBC.conx!rstUpdate.AddNew
'					F.ODBC.conx!rstUpdate.Set!PART(V.Local.sGSSPart)
'				F.Intrinsic.Control.EndIf
'				F.ODBC.conx!rstUpdate.Set!TEXT(V.DataTable.dtPostUpload(V.Local.iFor).DescExtra!FieldValTrim)
'				F.ODBC.conx!rstUpdate.Update
'				F.ODBC.conx!rstUpdate.Close
'			F.Intrinsic.Control.EndIf
'		F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.If(V.Local.bRebuild,=,True)
			F.Intrinsic.String.Build("select * from V_ROUTER_HEADER where ROUTER = '{0}'",V.DataTable.dtPostUpload(V.Local.iFor).PartNo!FieldValTrim,V.Local.sSQL)
			F.ODBC.Connection!conx.OpenLocalRecordsetRO("rstSel",V.Local.sSQL)
			F.Intrinsic.Control.If(V.ODBC.conx!rstSel.EOF,=,False)
				' Rebuild the routers
				F.Intrinsic.UI.ChangeWaitStatus("Rebuilding affected routers",V.Local.iFor,0,V.DataTable.dtPostUpload.RowCount--)
					F.Intrinsic.String.Build("{0}!*!{1}",V.Local.sGSSPart,V.Local.sGSSPart,V.Local.sRange)
					F.Global.General.CallWrapperSync(1001,V.Local.sRange)
			F.Intrinsic.Control.EndIf
			F.ODBC.conx!rstSel.Close
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.If(V.Local.bBin,=,True)
			F.Intrinsic.Control.If(V.DataTable.dtPostUpload(V.Local.iFor).DEFAULT_BIN!FieldValTrim,<>,"")
				F.Intrinsic.String.Build("select * from INVENTORY_MSTR where PART = '{0}'",V.Local.sGSSPart,V.Local.sSQL)
				F.ODBC.Connection!conx.OpenLocalRecordsetRW("rstUpdate",V.Local.sSQL)
				F.Intrinsic.Control.If(V.ODBC.conx!rstUpdate.EOF,=,False)
					F.ODBC.conx!rstUpdate.Set!BIN(V.DataTable.dtPostUpload(V.Local.iFor).DEFAULT_BIN!FieldValTrim)
					F.ODBC.conx!rstUpdate.Update
				F.Intrinsic.Control.EndIf
				F.ODBC.conx!rstUpdate.Close
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
		'ADDED 3/15/2020 BY TCM -- VENDOR SORT AND BOM COMMENTS
		'VENDOR SORT
		F.Intrinsic.Control.If(V.Local.bVendorSort,=,True)
			F.Intrinsic.Control.If(V.DataTable.dtPostUpload(V.Local.iFor).VENDOR_SORT!FieldValTrim,<>,"")
				F.Intrinsic.String.Build("select * from INVENTORY_MST2 where PART = '{0}'",V.Local.sGSSPart,V.Local.sSQL)
				F.ODBC.Connection!conx.OpenLocalRecordsetRW("rstUpdate",V.Local.sSQL)
				F.Intrinsic.Control.If(V.ODBC.conx!rstUpdate.EOF,=,False)
					F.ODBC.conx!rstUpdate.Set!NAME_VENDOR(V.DataTable.dtPostUpload(V.Local.iFor).VENDOR_SORT!FieldValTrim)
					F.ODBC.conx!rstUpdate.Update
				F.Intrinsic.Control.EndIf
				F.ODBC.conx!rstUpdate.Close
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
		'BOM_COMMENTS
		F.Intrinsic.Control.If(V.Local.bBOMComments,=,True)
			F.Intrinsic.Control.If(V.DataTable.dtPostUpload(V.Local.iFor).BOM_COMMENTS!FieldValTrim,<>,"")
				'SELECT THE SEQUENCE FROM BOM_MSTR
				F.Intrinsic.String.Build("SELECT SEQUENCE_BOM FROM BOM_MSTR WHERE PARENT = '{0}' AND PART = '{1}';",V.DataTable.dtPostUpload(V.Local.iFor).PARENT!FieldValTrim,V.Local.sGSSPart,V.Local.sSQL)
				F.ODBC.Connection!conx.EXECUTEANDRETURN(V.Local.sSQL,V.Local.sSequence)
				'IF PARENT = PART THEN NEED TO SET SEQUENCE TO 0000 BECAUSE PART IS NOT STORED IN THE BOM TABLE FOR THE PARENT ROW SO IT WILL RETURN BLANK
				F.Intrinsic.Control.If(V.DataTable.dtPostUpload(V.Local.iFor).PARENT!FieldValTrim,=,V.Local.sGSSPart)
					V.Local.sSequence.Set("0000")
				F.Intrinsic.Control.EndIf
				'CHECK IF BOM COMMENTS EXIST
				F.Intrinsic.String.Build("SELECT COUNT(1) FROM BOM_NOTES WHERE PARENT = '{0}' AND PARENT_SEQ = '{1}';",V.DataTable.dtPostUpload(V.Local.iFor).PARENT!FieldValTrim,V.Local.sSequence,V.Local.sSQL)
				F.ODBC.Connection!conx.EXECUTEANDRETURN(V.Local.sSQL,V.Local.iBomCommentsCount)
				V.Local.sBOMComments.set(V.DataTable.dtPostUpload(V.Local.iFor).BOM_COMMENTS!FieldValTrim)
				F.Intrinsic.Control.If(V.Local.iBomCommentsCount,>,0)
				'IF THEY DO THEN DO AN UPDATE
					F.Intrinsic.String.Build("UPDATE BOM_NOTES SET TEXT = '{0}' WHERE PARENT = '{1}' AND PARENT_SEQ = '{2}';",v.Local.sBOMComments.PSQLFriendly,V.DataTable.dtPostUpload(V.Local.iFor).PARENT!FieldValTrim,V.Local.sSequence,V.Local.sSQL)
					F.ODBC.Connection!conx.EXECUTE(V.Local.sSQL)
				'IF THE DO NOT THEN DO AN INSERT
				F.Intrinsic.Control.Else
					F.Intrinsic.String.Build("INSERT INTO BOM_NOTES VALUES ('{0}','{1}','00','{2}');",V.DataTable.dtPostUpload(V.Local.iFor).PARENT!FieldValTrim,V.Local.sSequence,v.Local.sBOMComments.PSQLFriendly,V.Local.sSQL)
					F.ODBC.Connection!conx.EXECUTE(V.Local.sSQL)
				F.Intrinsic.Control.EndIf
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
		
		'APPROVED & PREFERRED
		f.Intrinsic.Control.If(v.Local.bBOMApprPref)
			f.Intrinsic.String.Build("delete from bom_xref where part='{0}' AND PARENT='{1}'",v.Local.sGSSPart,V.DataTable.dtPostUpload(V.Local.iFor).PARENT!FieldValTrim,v.Local.sSQL)
			f.ODBC.Connection!conx.Execute(v.Local.sSQL)
			f.Intrinsic.Control.If(v.Datatable.dtPostUpload(v.Local.iFor).APPROVED!FieldValTrim,<>,"",OR,v.Datatable.dtPostUpload(v.Local.iFor).PREFERRED!FieldValTrim,=,"Y")
				F.Intrinsic.String.Format(V.Local.iFor,"0000",V.Local.sSequence)
				f.Data.DataTable.AddRow("dtBOMXref","PARENT",V.DataTable.dtPostUpload(V.Local.iFor).PARENT!FIELDVALTRIM,"PART",V.Local.sGSSPart,"SEQ",V.Local.sSequence,"MFG_PART",v.Local.sMfgPart,"MFG_NAME",v.Local.sMfgName,"PREFERRED",V.DataTable.dtPostUpload(V.Local.iFor).PREFERRED!FIELDVALTRIM)
				
				F.Intrinsic.String.Build("INSERT INTO BOM_XREF (PARENT,PART,SEQ,VENDOR,MFG_PART,MFG_NAME,PREFERRED) VALUES ('{0}','{1}','{2}','{3}','{4}','{5}','{6}');",V.DataTable.dtPostUpload(V.Local.iFor).PARENT!FIELDVALTRIM,V.Local.sGSSPart,V.Local.sSequence,V.DataTable.dtPostUpload(V.Local.iFor).VENDOR_CODE!FieldValTrim,v.Local.sMfgPart,V.Local.sMfgName,v.Datatable.dtPostUpload(v.Local.iFor).PREFERRED!FieldValTrim,V.Local.sSQL )
				f.ODBC.Connection!conx.Execute(v.Local.sSQL)
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf
	F.Intrinsic.Control.Next(V.Local.iFor)
F.Intrinsic.Control.EndIf

'Set BOM Complete flag for parents if the option is set
F.Data.DataTable.Select("dtOptions","HOOK = 50312 and SEQ = 5",V.Local.sRet)
F.Intrinsic.Control.If(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal,=,True)
	'Create dvPostUpload
	F.Data.DataView.Create("dtPostUpload","dvPostUpload")

	'Create dtDistinct
	F.Data.DataView.ToDataTableDistinct("dtPostUpload","dvPostUpload","dtDistinct","Parent")

	'Loop through dtDistinct and update BOM_MSTR.BOM_COMPLETE for each parent
	F.Intrinsic.Control.For(V.Local.iFor,0,V.DataTable.dtDistinct.RowCount--,1)
		F.Intrinsic.UI.ChangeWaitStatus("Marking Bills of Materials Complete",V.Local.iFor,0,V.DataTable.dtDistinct.RowCount--)
		F.Intrinsic.String.Build("update BOM_MSTR set BOM_COMPLETE = 'Y' where PARENT = '{0}' and SEQUENCE_BOM = '0000'",V.DataTable.dtDistinct(V.Local.iFor).Parent!FieldValTrim,V.Local.sSQL)
		F.ODBC.Connection!conx.Execute(V.Local.sSQL)
	F.Intrinsic.Control.Next(V.Local.iFor)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.CallSub(disconnect)
Program.Sub.postUpload.End

Program.Sub.LoadOptionsForm.Start
'Load each value according to the data table

gui.fOptions.cboDefaultMFG.AddItem("M",0)
gui.fOptions.cboDefaultMFG.AddItem("F",1)
gui.fOptions.cboDefaultMFG.ListIndex(0)
gui.fOptions.cboDefaultPur.AddItem("P",0)
gui.fOptions.cboDefaultPur.AddItem("J",1)
gui.fOptions.cboDefaultPur.ListIndex(0)
gui.fOptions.tabMain.SetTab(0)
F.Intrinsic.Control.BlockEvents
F.Intrinsic.Control.CallSub(setvalues)
F.Intrinsic.Control.UnBlockEvents
gui.fOptions..Show
Program.Sub.LoadOptionsForm.End

Program.Sub.fMain_UnLoad.Start
gui.fOptions..Visible(0)
F.Intrinsic.Control.End

Program.Sub.fMain_UnLoad.End

Program.Sub.cmdSave_Click.Start
V.Local.iFor.Declare
F.Intrinsic.Control.CallSub(storevalues)
F.Data.DataTable.AcceptChanges("dtOptions")

F.Intrinsic.Control.For(V.Local.iFor,0,V.DataTable.dtOptions.RowCount--,1)
	F.Global.Registry.AddValue(-1,V.Caller.CompanyCode,"GAB_5308",V.DataTable.dtOptions(V.Local.iFor).HOOK!FieldVal,V.DataTable.dtOptions(V.Local.iFor).SEQ!FieldVal,False,V.DataTable.dtOptions(V.Local.iFor).SVAL!FieldValTrim,V.DataTable.dtOptions(V.Local.iFor).BVAL!FieldVal,-1,0,V.Ambient.Date,V.Ambient.Time)
F.Intrinsic.Control.Next(V.Local.iFor)

F.Intrinsic.UI.Msgbox("Settings Saved","BOM Compare Options")
Program.Sub.cmdSave_Click.End

Program.Sub.chkPreLoad_Click.Start
gui.fOptions.frmPreLoad.Enabled(V.Screen.fOptions!chkPreLoad.Value)
Program.Sub.chkPreLoad_Click.End

Program.Sub.chkDefaultSource_Click.Start
gui.fOptions.frmDefaultSource.Enabled(V.Screen.fOptions!chkDefaultSource.Value)
Program.Sub.chkDefaultSource_Click.End

Program.Sub.cboDefaultMFG_Click.Start
Program.Sub.cboDefaultMFG_Click.End

Program.Sub.cboDefaultPur_Click.Start
Program.Sub.cboDefaultPur_Click.End

Program.Sub.chkUpdatePreview_Click.Start
gui.fOptions.frmUpdatePreview.Enabled(V.Screen.fOptions!chkUpdatePreview.Value)
Program.Sub.chkUpdatePreview_Click.End

Program.Sub.chkPreviewDesc_Click.Start
Program.Sub.chkPreviewDesc_Click.End

Program.Sub.chkPreviewSource_Click.Start
Program.Sub.chkPreviewSource_Click.End

Program.Sub.chkPreviewPL_Click.Start
Program.Sub.chkPreviewPL_Click.End

Program.Sub.chkPreUpload_Click.Start
gui.fOptions.frmPreUpload.Enabled(V.Screen.fOptions!chkPreUpload.Value)
Program.Sub.chkPreUpload_Click.End

Program.Sub.chkCpyRtr_Click.Start
Program.Sub.chkCpyRtr_Click.End

Program.Sub.chkPostUpload_Click.Start
gui.fOptions.frmPostUpload.Enabled(V.Screen.fOptions!chkPostUpload.Value)
Program.Sub.chkPostUpload_Click.End

Program.Sub.chkXrefVen_Click.Start
Program.Sub.chkXrefVen_Click.End

Program.Sub.chkXrefCust_Click.Start
Program.Sub.chkXrefCust_Click.End

Program.Sub.chkAltDesc_Click.Start
Program.Sub.chkAltDesc_Click.End

Program.Sub.chkExtraDesc_Click.Start
Program.Sub.chkExtraDesc_Click.End

Program.Sub.chkBOMComplete_Click.Start
Program.Sub.chkBOMComplete_Click.End

Program.Sub.chkRebuildRtrs_Click.Start
Program.Sub.chkRebuildRtrs_Click.End

Program.Sub.setValues.Start
V.Local.iVal.Declare

V.Local.iVal.Set(-1)

F.Data.DataView.Create("dtOptions","dv50310")
F.Data.DataView.SetFilter("dtOptions","dv50310","HOOK = 50310")
F.Data.DataView.Create("dtOptions","dv50311")
F.Data.DataView.SetFilter("dtOptions","dv50311","HOOK = 50311")
F.Data.DataView.Create("dtOptions","dv50312")
F.Data.DataView.SetFilter("dtOptions","dv50312","HOOK = 50312")

'Hook 50310
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkPreLoad.Value(V.DataView.dtOptions!dv50310(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkDefaultSource.Value(V.DataView.dtOptions!dv50310(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.cboDefaultMFG.Text(V.DataView.dtOptions!dv50310(V.Local.iVal).SVAL!FieldValTrim)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.cboDefaultPur.Text(V.DataView.dtOptions!dv50310(V.Local.iVal).SVAL!FieldValTrim)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkUpdatePreview.Value(V.DataView.dtOptions!dv50310(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkPreviewDesc.Value(V.DataView.dtOptions!dv50310(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkPreviewSource.Value(V.DataView.dtOptions!dv50310(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkPreviewPL.Value(V.DataView.dtOptions!dv50310(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkPreviewSC.Value(V.DataView.dtOptions!dv50310(V.Local.iVal).BVAL!FieldVal)

V.Local.iVal.Set(-1)


'Hook 50311
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkPreUpload.Value(V.DataView.dtOptions!dv50311(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkCpyRtr.Value(V.DataView.dtOptions!dv50311(V.Local.iVal).BVAL!FieldVal)
'V.Local.iVal.Set(V.Local.iVal.++)
'gui.fOptions.chkBOMComments.Value(V.DataView.dtOptions!dv50311(V.Local.iVal).BVAL!FieldVal)

V.Local.iVal.Set(-1)

'Hook 50312
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkPostUpload.Value(V.DataView.dtOptions!dv50312(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkXrefVen.Value(V.DataView.dtOptions!dv50312(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkXrefCust.Value(V.DataView.dtOptions!dv50312(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkAltDesc.Value(V.DataView.dtOptions!dv50312(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkExtraDesc.Value(V.DataView.dtOptions!dv50312(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkBOMComplete.Value(V.DataView.dtOptions!dv50312(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkRebuildRtrs.Value(V.DataView.dtOptions!dv50312(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkDefaultBin.Value(V.DataView.dtOptions!dv50312(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
'Added 3/15/20 by TCM -- Inventory Vendor Sort and BOM Comments
gui.fOptions.chkVendorSort.Value(V.DataView.dtOptions!dv50312(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
gui.fOptions.chkBOMComments.Value(V.DataView.dtOptions!dv50312(V.Local.iVal).BVAL!FieldVal)
V.Local.iVal.Set(V.Local.iVal.++)
'Added 8/11/2020 by DD -- Mfg Part Approved/Preferred
gui.fOptions.chkMfgPartAppr.Value(v.DataView.dtOptions!dv50312(v.Local.iVal).BVAL!FieldVal)

gui.fOptions.frmPreLoad.Enabled(V.Screen.fOptions!chkPreLoad.Value)
gui.fOptions.frmDefaultSource.Enabled(V.Screen.fOptions!chkDefaultSource.Value)
gui.fOptions.frmUpdatePreview.Enabled(V.Screen.fOptions!chkUpdatePreview.Value)
gui.fOptions.frmPreUpload.Enabled(V.Screen.fOptions!chkPreUpload.Value)
gui.fOptions.frmPostUpload.Enabled(V.Screen.fOptions!chkPostUpload.Value)

F.Data.DataView.Close("dtOptions","dv50310")
F.Data.DataView.Close("dtOptions","dv50311")
F.Data.DataView.Close("dtOptions","dv50312")
Program.Sub.setValues.End

Program.Sub.storeValues.Start
V.Local.iVal.Declare

F.Data.DataView.Create("dtOptions","dv50310")
F.Data.DataView.SetFilter("dtOptions","dv50310","HOOK = 50310")
F.Data.DataView.Create("dtOptions","dv50311")
F.Data.DataView.SetFilter("dtOptions","dv50311","HOOK = 50311")
F.Data.DataView.Create("dtOptions","dv50312")
F.Data.DataView.SetFilter("dtOptions","dv50312","HOOK = 50312")

V.Local.iVal.Set(-1)

'Hook 50310
F.Data.DataView.SetValue("dtOptions","dv50310",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkPreLoad.Value)
F.Data.DataView.SetValue("dtOptions","dv50310",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkDefaultSource.Value)
F.Data.DataView.SetValue("dtOptions","dv50310",V.Local.iVal.++,"SVAL",V.Screen.fOptions!cboDefaultMFG.Text)
F.Data.DataView.SetValue("dtOptions","dv50310",V.Local.iVal.++,"SVAL",V.Screen.fOptions!cboDefaultPur.Text)
F.Data.DataView.SetValue("dtOptions","dv50310",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkUpdatePreview.Value)
F.Data.DataView.SetValue("dtOptions","dv50310",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkPreviewDesc.Value)
F.Data.DataView.SetValue("dtOptions","dv50310",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkPreviewSource.Value)
F.Data.DataView.SetValue("dtOptions","dv50310",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkPreviewPL.Value)
F.Data.DataView.SetValue("dtOptions","dv50310",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkPreviewSC.Value)

V.Local.iVal.Set(-1)

'Hook 50311
F.Data.DataView.SetValue("dtOptions","dv50311",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkPreUpLoad.Value)
F.Data.DataView.SetValue("dtOptions","dv50311",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkCpyRtr.Value)
'F.Data.DataView.SetValue("dtOptions","dv50311",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkBOMComments.Value)

V.Local.iVal.Set(-1)

'Hook 50312
F.Data.DataView.SetValue("dtOptions","dv50312",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkPostUpload.Value)
F.Data.DataView.SetValue("dtOptions","dv50312",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkXrefVen.Value)
F.Data.DataView.SetValue("dtOptions","dv50312",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkXrefCust.Value)
F.Data.DataView.SetValue("dtOptions","dv50312",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkAltDesc.Value)
F.Data.DataView.SetValue("dtOptions","dv50312",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkExtraDesc.Value)
F.Data.DataView.SetValue("dtOptions","dv50312",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkBOMComplete.Value)
F.Data.DataView.SetValue("dtOptions","dv50312",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkRebuildRtrs.Value)
F.Data.DataView.SetValue("dtOptions","dv50312",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkDefaultBin.Value)
'added 3/15/2020 by TCM -- Include Inv vendor sort and bom comments
F.Data.DataView.SetValue("dtOptions","dv50312",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkVendorSort.Value)
F.Data.DataView.SetValue("dtOptions","dv50312",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkBOMComments.Value)
F.Data.DataView.SetValue("dtOptions","dv50312",V.Local.iVal.++,"BVAL",V.Screen.fOptions!chkMfgPartAppr.Value)

F.Data.DataView.Close("dtOptions","dv50310")
F.Data.DataView.Close("dtOptions","dv50311")
F.Data.DataView.Close("dtOptions","dv50312")
Program.Sub.storeValues.End

Program.Sub.LoaddtRouter.Start
V.Local.iRow.Declare
V.Local.sRouter.Declare
V.Local.sSQL.Declare
V.Local.sTarget.Declare

V.Local.iRow.Set(V.Args.Row)
V.Local.sRouter.Set(V.Args.Router)
V.Local.sTarget.Set(V.Args.Target)

'Close dtTemp if it exists
F.Intrinsic.Control.If(V.DataTable.dtTemp.Exists,=,True)
	F.Data.DataTable.DeleteRow("dtTemp")
	F.Data.DataTable.Close("dtTemp")
F.Intrinsic.Control.EndIf

'Read Material, Comment and Outside Records from ROUTER_LINE into dtTemp
F.Intrinsic.String.Build("select A.ROUTER, '{0}' AS NEWROUTER, A.LINE_ROUTER, A.LMO, A.PART_WC_OUTSIDE AS PART_NO_OUTSIDE, A.DESC_RT_LINE, A.SET_UP, A.RUN_TIME, A.OPERATION, A.RATE, A.UM_INVENTORY, A.FREQUENCY, A.OVERLAP, A.WC_FACTOR, A.FLAG_MINIMUM, A.AMT_MINIMUM, A.CREW_SIZE, A.LEAD_TIME, '' AS WORKCENTER, B.PROD_LINE, B.CUSTOMER, C.QUANTITY_1, C.QUANTITY_2, C.QUANTITY_3, C.QUANTITY_4, D.QUANTITY_5, D.QUANTITY_6, D.QUANTITY_7, D.QUANTITY_8, E.QUANTITY_9, E.QUANTITY_10 FROM V_ROUTER_LINE A left outer join V_ROUTER_HEADER B on A.ROUTER = B.ROUTER left outer join V_RTR_PRICE_1_4 C on A.ROUTER = C.ROUTER left outer join V_RTR_PRICE_5_8 D on A.ROUTER = D.ROUTER left outer join V_RTR_PRICE_9_10 E on A.ROUTER = E.ROUTER WHERE A.LMO <> 'L' AND A.ROUTER = '{1}' AND (C.LINE_ROUTER = '' or isnull(C.LINE_ROUTER,'True') = 'True') AND (D.LINE_ROUTER = '' or isnull(D.LINE_ROUTER,'True') = 'True') AND (E.LINE_ROUTER = '' or isnull(E.LINE_ROUTER,'True') = 'True')",V.Local.sTarget,V.Local.sRouter,V.Local.sSQl)
F.Data.DataTable.CreateFromSQL("dtTemp","conx",V.Local.sSQL,True)
F.Data.DataTable.Merge("dtTemp","dtRouter",True,1)
F.Data.DataTable.AcceptChanges("dtRouter")

'Close dtTemp if it exists
F.Intrinsic.Control.If(V.DataTable.dtTemp.Exists,=,True)
	F.Data.DataTable.DeleteRow("dtTemp")
	F.Data.DataTable.Close("dtTemp")
F.Intrinsic.Control.EndIf

'Read Labor Records from ROUTER_LINE
F.Intrinsic.String.Build("select A.ROUTER, '{0}' AS NEWROUTER, A.LINE_ROUTER, A.LMO, A.PART_WC_OUTSIDE as WORKCENTER, A.DESC_RT_LINE, A.SET_UP, A.RUN_TIME, A.OPERATION, A.RATE, A.UM_INVENTORY, A.FREQUENCY, A.OVERLAP, A.WC_FACTOR, A.FLAG_MINIMUM, A.AMT_MINIMUM, A.CREW_SIZE, A.LEAD_TIME, '' AS PART_NO_OUTSIDE, B.PROD_LINE, B.CUSTOMER, C.QUANTITY_1, C.QUANTITY_2, C.QUANTITY_3, C.QUANTITY_4, D.QUANTITY_5, D.QUANTITY_6, D.QUANTITY_7, D.QUANTITY_8, E.QUANTITY_9, E.QUANTITY_10 FROM V_ROUTER_LINE A left outer join V_ROUTER_HEADER B on A.ROUTER = B.ROUTER left outer join V_RTR_PRICE_1_4 C on A.ROUTER = C.ROUTER left outer join V_RTR_PRICE_5_8 D on A.ROUTER = D.ROUTER left outer join V_RTR_PRICE_9_10 E on A.ROUTER = E.ROUTER where A.LMO = 'L' AND A.ROUTER = '{1}' AND (C.LINE_ROUTER = '' or isnull(C.LINE_ROUTER,'True') = 'True') AND (D.LINE_ROUTER = '' or isnull(D.LINE_ROUTER,'True') = 'True') AND (E.LINE_ROUTER = '' or isnull(E.LINE_ROUTER,'True') = 'True')",V.Local.sTarget,V.Local.sRouter,V.Local.sSQl)
F.Data.DataTable.CreateFromSQL("dtTemp","conx",V.Local.sSQL,True)

F.Data.DataTable.Merge("dtTemp","dtRouter",True,1)
F.Data.DataTable.AcceptChanges("dtRouter")

'Close dtTemp if it exists
F.Intrinsic.Control.If(V.DataTable.dtTemp.Exists,=,True)
	F.Data.DataTable.DeleteRow("dtTemp")
	F.Data.DataTable.Close("dtTemp")
F.Intrinsic.Control.EndIf


Program.Sub.LoaddtRouter.End

Program.Sub.UploadRouters.Start
' Create a flat file from dtRouter and upload it using UPLRTRH

V.Local.bFileCheck.Declare(Boolean)
V.Local.bFileCheckOld.Declare(Boolean)
V.Local.iFor.Declare(Long)
V.Local.sData.Declare
V.Local.sFile.Declare(String)
V.Local.sFileName.Declare(String)
V.Local.sFileOld.Declare(String)
V.Local.sHold.Declare(String)
V.Local.sLine.Declare
V.Local.sParams.Declare
V.Local.sPart17.Declare
V.Local.sRet.Declare
V.Local.sSel.Declare
V.Local.sSplit.Declare
V.Local.sTemp.Declare
V.Local.bRevisions.Declare

' Check for ROUTERHD in Global Files, create a backup if it exists
V.Local.sFileName.Set("ROUTERHD")
F.Intrinsic.String.Concat(V.Caller.FilesDir,"\",V.Local.sFileName,".TXT",V.Local.sFile)

' Loop through the Router DT and write the lines to the flat file
F.Intrinsic.Control.For(V.Local.iFor,0,V.DataTable.dtRouter.RowCount--,1)
	F.Intrinsic.UI.ChangeWaitStatus("Writing Upload File",V.Local.iFor,0,V.DataTable.dtRouter.RowCount--)
	' Add lines to string
	'NEWROUTER	1	20	20
	F.Intrinsic.String.RPad(V.DataTable.dtRouter(V.Local.iFor).NEWROUTER!FieldValTrim," ",20,V.Local.sLine)
	'ROUTER DESCRIPTION	21	50	30
	'Need to check and see if customer is using revisions
	'70008 revision option
	'if they are using the "use revisions" option then grab the left 17, otherwise grab the 20 character part
	F.Global.General.ReadOption("70008",0,False,"0000",v.Local.bRevisions)
	f.Intrinsic.Control.If(v.Local.bRevisions)
		F.Intrinsic.String.Left(V.DataTable.dtRouter(V.Local.iFor).NEWROUTER!FieldValTrim,17,V.Local.sPart17)
	f.Intrinsic.Control.Else
		v.Local.sPart17.Set(V.DataTable.dtRouter(V.Local.iFor).NEWROUTER!FieldValTrim)
	f.Intrinsic.Control.EndIf
	F.Intrinsic.String.Build("PartNo = '{0}'",V.Local.sPart17.Trim,V.Local.sSel)
	F.Data.DataTable.Select("dtPreUpload",V.Local.sSel,V.Local.sRet)
	F.Intrinsic.Control.If(V.Local.sRet,<>,"***NORETURN***")
		V.Local.sSplit.Redim(0,0)
		F.Intrinsic.String.Split(V.Local.sRet,"*!*",V.Local.sSplit)
	F.Intrinsic.Control.EndIf
	F.Intrinsic.String.Concat(V.Local.sLine,V.DataTable.dtPreUpload(V.Local.sSplit(0)).Description!FieldValTrim,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",50,V.Local.sLine)
	'LINE_ROUTER	51	56	6
	F.Intrinsic.String.Concat(V.Local.sLine,V.DataTable.dtRouter(V.Local.iFor).LINE_ROUTER!FieldValTrim,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",56,V.Local.sLine)	
	'LMO	57	57	1	
	F.Intrinsic.String.Concat(V.Local.sLine,V.DataTable.dtRouter(V.Local.iFor).LMO!FieldValTrim,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",57,V.Local.sLine)
	'PART_NO_OUTSIDE	58	77	20	
	F.Intrinsic.String.Concat(V.Local.sLine,V.DataTable.dtRouter(V.Local.iFor).PART_NO_OUTSIDE!FieldValTrim,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",77,V.Local.sLine)
	'WORKCENTER	78	81	4	
	F.Intrinsic.String.Concat(V.Local.sLine,V.DataTable.dtRouter(V.Local.iFor).WORKCENTER!FieldValTrim,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",81,V.Local.sLine)
	'DESC_RT_LINE	82	111	30	
	F.Intrinsic.String.Concat(V.Local.sLine,V.DataTable.dtRouter(V.Local.iFor).DESC_RT_LINE!FieldValTrim,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",111,V.Local.sLine)
	'SET_UP	112	127	16	8.4
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).SET_UP!FieldValTrim,"00000000.0000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",127,V.Local.sLine)
	'RUN_TIME	128	143	16	8.6
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).RUN_TIME!FieldValTrim,"00000000.000000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",143,V.Local.sLine)
	'CUSTOMER   144 149
	F.Intrinsic.String.Concat(V.Local.sLine,V.DataTable.dtRouter(V.Local.iFor).CUSTOMER!FieldValTrim,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",155,V.Local.sLine)
	'OPERATION	156	161	6	
	F.Intrinsic.String.Concat(V.Local.sLine,V.DataTable.dtRouter(V.Local.iFor).OPERATION!FieldValTrim,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",161,V.Local.sLine)
	'RATE	162	177	16	8.4
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).RATE!FieldValTrim,"00000000.0000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",177,V.Local.sLine)
	'UM_INVENTORY	178	179	2
	'MT	180	392
	F.Intrinsic.String.Concat(V.Local.sLine,V.DataTable.dtRouter(V.Local.iFor).UM_INVENTORY!FieldValTrim,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",392,V.Local.sLine)
	'QUANTITY 1 393 408	16	8.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).QUANTITY_1!FieldValTrim,"00000000.0000000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",408,V.Local.sLine)
	'QUANTITY 2 409 424 16	8.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).QUANTITY_2!FieldValTrim,"00000000.0000000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",424,V.Local.sLine)
	'QUANTITY 3 425 440	16	8.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).QUANTITY_3!FieldValTrim,"00000000.0000000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",440,V.Local.sLine)
	'QUANTITY 4	441	456	16	8.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).QUANTITY_4!FieldValTrim,"00000000.0000000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",457,V.Local.sLine)
	'FREQUENCY	458	473	16	6.0
	'MT	474	489	
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).FREQUENCY!FieldValTrim,"000000.0",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",489,V.Local.sLine)
	'OVERLAP	490	505	16	2.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).OVERLAP!FieldValTrim,"00.0",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",505,V.Local.sLine)
	'WC_FACTOR	506	521	16	2.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).WC_FACTOR!FieldValTrim,"00.0",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",521,V.Local.sLine)
	'FLAG_MINIMUM	522	522	1
	F.Intrinsic.String.Concat(V.Local.sLine,V.DataTable.dtRouter(V.Local.iFor).FLAG_MINIMUM!FieldValTrim,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",522,V.Local.sLine)	
	'AMT_MINIMUM	523	538	16	8.4
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).AMT_MINIMUM!FieldValTrim,"00000000.0000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",538,V.Local.sLine)
	'CREW_SIZE	539	554	16	4.4
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).CREW_SIZE!FieldValTrim,"0000.0000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",554,V.Local.sLine)
	'LEAD_TIME	555	570	16	4.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).LEAD_TIME!FieldValTrim,"0000.0",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",965,v.Local.sLine)
	'QUANTITY 5	966	981	16	8.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).QUANTITY_5!FieldValTrim,"00000000.0000000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",981,V.Local.sLine)
	'QUANTITY 6	982	997	16	8.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).QUANTITY_6!FieldValTrim,"00000000.0000000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",997,V.Local.sLine)
	'QUANTITY 7	998	1013	16	8.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).QUANTITY_7!FieldValTrim,"00000000.0000000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",1013,V.Local.sLine)
	'QUANTITY 8	1014	1029	16	8.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).QUANTITY_8!FieldValTrim,"00000000.0000000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",1029,V.Local.sLine)
	'QUANTITY 9	1030	1045	16	8.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).QUANTITY_9!FieldValTrim,"00000000.0000000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",1045,V.Local.sLine)
	'QUANTITY 10	1046	1061	16	8.0
	F.Intrinsic.String.Format(V.DataTable.dtRouter(V.Local.iFor).QUANTITY_10!FieldValTrim,"00000000.0000000",V.Local.sTemp)
	F.Intrinsic.String.Concat(V.Local.sLine,V.Local.sTemp,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",1070,V.Local.sLine)
	'PROD_LINE 1071 1072 2
	F.Intrinsic.String.Concat(V.Local.sLine,V.DataTable.dtRouter(V.Local.iFor).PROD_LINE!FieldValTrim,V.Local.sLine)
	F.Intrinsic.String.RPad(V.Local.sLine," ",1072,V.Local.sLine)
	'		1090	if it's a comment line, make the last byte a Y so it will create a comment sequence
	'Pad with spaces to 1089, then add Y if comment, or space if it's not
	F.Intrinsic.String.RPad(V.Local.sLine," ",1089,V.Local.sLine)
	F.Intrinsic.Control.If(V.DataTable.dtRouter(V.Local.iFor).LMO!FieldValTrim,=,"C")
		F.Intrinsic.String.Concat(V.Local.sLine,"Y",V.Local.sLine)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat(V.Local.sLine," ",V.Local.sLine)
	F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.If(V.Local.sData.Trim,=,"")
		V.Local.sData.Set(V.Local.sLine)
	F.Intrinsic.Control.Else
		F.Intrinsic.String.Concat(V.Local.sData,V.Ambient.NewLine,V.Local.sLine,V.Local.sData)
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.Next(V.Local.iFor)

'String to file
F.Intrinsic.File.String2File(V.Local.sFile,V.Local.sData)

F.Intrinsic.UI.ChangeWaitStatus("Uploading Routers",0,0,100)
' Run the 1Shot to upload the file
'F.Global.General.CallWrapperSync(50,"UPLRTRH/A/X")

'Setup params for call
F.Intrinsic.String.ConcatCallWrapperArgs(1,"ROUTERHD",V.Local.sParams)

F.Global.General.CallWrapperSync(6021,V.Local.sParams)

Program.Sub.UploadRouters.End

Program.Sub.unload.Start
F.Intrinsic.Control.CallSub(disconnect)
F.Intrinsic.Control.End

Program.Sub.unload.End

Program.Sub.addRouterComments.Start
V.Local.iFor.Declare
V.Local.sSeq.Declare
V.Local.sSQL.Declare

'Loop through dtRouter and insert comment sequences into RTR_SEQ_COMMENTS
F.Intrinsic.Control.For(V.Local.iFor,0,V.DataTable.dtRouter.RowCount--,1)
	F.Intrinsic.String.Build("select * from RTR_SEQ_COMMENTS where RTR_NUMBER = '{0}' and RTR_SEQ = '{1}'",V.DataTable.dtRouter(V.Local.iFor).ROUTER!FieldValTrim,V.DataTable.dtRouter(V.Local.iFor).LINE_ROUTER!FieldValTrim,V.Local.sSQL)
	F.ODBC.Connection!conx.OpenLocalRecordsetRO("rstSel",V.Local.sSQL)
	'F.Intrinsic.Control.If(V.ODBC.conx!rstSel.EOF,=,False)
		'F.Intrinsic.String.Build("insert into RTR_SEQ_COMMENTS VALUES ('{0}','{1}','{2}'",V.DataTable.dtRouter(V.Local.iFor).NEWROUTER!FieldValTrim,V.ODBC.conx!rstSel.FieldValTrim!RTR_SEQ,V.ODBC.conx!rstSel.FieldValTrim!TEXT,V.Local.sSQL)
		'F.ODBC.Connection!conx.Execute(V.Local.sSQL)
	'F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.If(V.ODBC.conx!rstSel.EOF,=,False)
		F.Intrinsic.String.Format(V.ODBC.conx!rstSel.FieldValTrim!RTR_SEQ,"000000",V.Local.sSeq)
		F.Intrinsic.String.Build("select * from RTR_SEQ_COMMENTS where RTR_NUMBER = '{0}' and RTR_SEQ = '{1}'",V.DataTable.dtRouter(V.Local.iFor).NEWROUTER!FieldValTrim,V.Local.sSeq,V.Local.sSQL)
		F.ODBC.Connection!conx.OpenLocalRecordsetRW("rstUpdate",V.Local.sSQL)
		F.Intrinsic.Control.If(V.ODBC.conx!rstUpdate.EOF,=,True)
			F.ODBC.conx!rstUpdate.AddNew
			F.ODBC.conx!rstUpdate.Set!RTR_NUMBER(V.DataTable.dtRouter(V.Local.iFor).NEWROUTER!FieldValTrim)
			F.ODBC.conx!rstUpdate.Set!RTR_SEQ(V.ODBC.conx!rstSel.FieldValTrim!RTR_SEQ)
			F.ODBC.conx!rstUpdate.Set!TEXT(V.ODBC.conx!rstSel.FieldValTrim!TEXT)
			F.ODBC.conx!rstUpdate.Update
		F.Intrinsic.Control.EndIf
		F.ODBC.conx!rstUpdate.Close
	F.Intrinsic.Control.EndIf
	F.ODBC.conx!rstSel.Close
F.Intrinsic.Control.Next(V.Local.iFor)


Program.Sub.addRouterComments.End

Program.Sub.savePreloadBDF.Start
V.Local.iFor.Declare
V.Local.sRow.Declare
v.Local.sSQL.Declare
v.Local.sBOMRef.Declare
v.Local.sSource.Declare
v.Local.sLinesString.Declare
V.Local.sFileTarget.Declare
V.Local.sFile.Declare
v.Local.sRet.Declare
F.Intrinsic.String.Build("{0}Temp_6059.txt",V.Caller.LocalGSSTempDir,V.Local.sFile)
f.Intrinsic.File.File2String(v.Local.sFile,v.Local.sRet)

'Clone the bdf
F.Intrinsic.BDF.Clone("bdfPreload","bdfClone")

'Redim sRow
V.Local.sRow.Redim(0,0)
V.Local.sRow.Set("")

f.Intrinsic.Control.If(v.Local.sRet,=,"CusBOMCompare")
		'Loop through dtPreLoad
	F.Intrinsic.Control.For(V.Local.iFor,0,V.DataTable.dtPreload.RowCount--,1)
		'a.	Purchase to Stock = Normal
		'b.	Manufacture to Stock = Normal
		'c.	Manufacture to Job = Phantom
		'd.	Purchase to Job = Normal
		
		
		'don't update if it is parent
		f.Intrinsic.Control.If(V.DataTable.dtPreload(V.Local.iFor).DISPLAYPART!FieldValTrim,<>,V.DataTable.dtPreload(V.Local.iFor).PARENT!FieldValTrim)
			'If BOM_REF is checked then set to Reference
			f.Intrinsic.String.Build("Select BOM_REF from INVENTORY_MST3 where PART = '{0}';",V.DataTable.dtPreload(V.Local.iFor).DISPLAYPART!FieldValTrim,v.Local.sSQL)
			f.ODBC.Connection!Conx.ExecuteAndReturn(v.Local.sSQL,v.Local.sBOMRef)
			f.Intrinsic.Control.If(v.Local.sBOMRef,=,"Y")
				f.Data.DataTable.SetValue("dtPreload",v.Local.iFor,"CATEGORY","R")
			f.Intrinsic.Control.Else
			'check soure in Inventory Master first
			
				f.Intrinsic.String.Build("Select RTRIM(CODE_SOURCE) from INVENTORY_MST2 where PART = '{0}';",V.DataTable.dtPreload(V.Local.iFor).DISPLAYPART!FieldValTrim,v.Local.sSQL)
				f.ODBC.Connection!Conx.ExecuteAndReturn(v.Local.sSQL,v.Local.sSource)
				'if source of inventory matching with source in BOM compare options
				f.Intrinsic.Control.If(v.Local.sSource,=,"", OR, v.Local.sSource,=,"F")
					f.Intrinsic.Control.If(V.DataTable.dtPreload(V.Local.iFor).SOURCE!FieldValTrim,=,"F")
						f.Data.DataTable.SetValue("dtPreload",v.Local.iFor,"CATEGORY","P")
					f.Intrinsic.Control.EndIf
				' not matching
				f.Intrinsic.Control.Else
					f.Intrinsic.Control.If(v.local.sSource,=,"F")
						f.Data.DataTable.SetValue("dtPreload",v.Local.iFor,"CATEGORY","P")
					f.Intrinsic.Control.EndIf
				f.Intrinsic.Control.EndIf	
			f.Intrinsic.Control.EndIf
		f.Intrinsic.Control.EndIf
		'Post to the bdfClone
		F.Intrinsic.String.Replace(V.DataTable.dtPreload(V.Local.iFor).FullRow,"*!*","|~|",V.Local.sRow)
		f.Intrinsic.String.Build("{0}{1}{2}",v.Local.sLinesString,v.Local.sRow,v.Ambient.NewLine,v.Local.sLinesString)
		F.Intrinsic.BDF.WriteRow("bdfClone",V.Local.sRow)
	F.Intrinsic.Control.Next(V.Local.iFor)
	
	'=================================================================================================================================
	F.Intrinsic.String.Build("{0}BOM_Temp",V.Caller.LocalGSSTempDir,V.Local.sFileTarget)
	f.Intrinsic.File.String2File(v.Local.sFileTarget,v.Local.sLinesString)
	
	'===================================================================================================================================

f.Intrinsic.Control.Else
		'Loop through dtPreLoad
	F.Intrinsic.Control.For(V.Local.iFor,0,V.DataTable.dtPreload.RowCount--,1)
		'Post to the bdfClone
		F.Intrinsic.String.Replace(V.DataTable.dtPreload(V.Local.iFor).FullRow,"*!*","|~|",V.Local.sRow)
		F.Intrinsic.BDF.WriteRow("bdfClone",V.Local.sRow)
	F.Intrinsic.Control.Next(V.Local.iFor)
	
f.Intrinsic.Control.EndIf

F.Intrinsic.BDF.Save("bdfClone","Main-PrePopulate-bdf")

F.Intrinsic.Control.CallSub(disconnect)
F.Intrinsic.Control.End

Program.Sub.savePreloadBDF.End

Program.Sub.loadfmain.Start
V.Local.bDescription.Declare
V.Local.bPL.Declare
V.Local.bSortCode.Declare
V.Local.bSource.Declare
V.Local.iFor.Declare
V.Local.iIndex.Declare
V.Local.sDefault.Declare
V.Local.sGSSPart.Declare
V.Local.sGv.Declare
V.Local.sProperty.Declare
V.Local.sRet.Declare
V.Local.sSQL.Declare

'Check to see if the options are checked for Description, Source, and Product Line
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 5",V.Local.sRet)
V.Local.bDescription.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal)
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 6",V.Local.sRet)
V.Local.bSource.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal)
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 7",V.Local.sRet)
V.Local.bPL.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal)
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 8",V.Local.sRet)
V.Local.bSortCode.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal)

'Add Columns for Product line, Unit of Measure, and Description Checkboxes
F.Intrinsic.Control.If(V.Local.bPL,=,True)
	F.Data.DataTable.AddColumn("dtPreload","PLCheck",Boolean,False)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bDescription,=,True)
	F.Data.DataTable.AddColumn("dtPreload","DescCheck",Boolean,False)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSource,=,True)
	F.Data.DataTable.AddColumn("dtPreload","SrcCheck",Boolean,False)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
	F.Data.DataTable.AddColumn("dtPreload","SortCheck",Boolean,False)
F.Intrinsic.Control.EndIf
F.Data.DataTable.AddColumn("dtPreload","DiffCheck",Boolean,False)

'Loop through dtPreload and check for differences in the inventory master
F.Intrinsic.Control.For(V.Local.iFor,0,V.DataTable.dtPreload.RowCount--,1)
	F.Intrinsic.UI.ChangeWaitStatus("Validating Differences",V.Local.iFor,0,V.DataTable.dtPreload.RowCount--)
	F.Intrinsic.String.GSSPartString(V.DataTable.dtPreload(V.Local.iFor).PARTNO!FieldValTrim,V.DataTable.dtPreload(V.Local.iFor).REVISION!FieldValTrim,V.Local.sGSSPart)
	F.Intrinsic.String.Build("select * from V_INVENTORY_ALL where PART = '{0}'",V.Local.sGSSPart,V.Local.sSQL)
	F.ODBC.Connection!conx.OpenLocalRecordsetRO("rstSel",V.Local.sSQL)
	F.Intrinsic.Control.If(V.ODBC.conx!rstSel.EOF,=,False)
		F.Intrinsic.Control.If(V.Local.bPL,=,True)
			F.Intrinsic.Control.If(V.ODBC.conx!rstSel.FieldValTrim!PRODUCT_LINE,<>,V.DataTable.dtPreload(V.Local.iFor).PRODUCTLINE!FieldValTrim)
			F.Intrinsic.Control.AndIf(V.DataTable.dtPreload(V.Local.iFor).PRODUCTLINE!FieldValTrim,<>,"")
				F.Data.DataTable.SetValue("dtPreload",V.Local.iFor,"DiffCheck",True)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.If(V.Local.bDescription,=,True)
			F.Intrinsic.Control.If(V.ODBC.conx!rstSel.FieldValTrim!DESCRIPTION,<>,V.DataTable.dtPreload(V.Local.iFor).DESCRIPTION!FieldValTrim)
			F.Intrinsic.Control.AndIf(V.DataTable.dtPreload(V.Local.iFor).DESCRIPTION!FieldValTrim,<>,"")
				F.Data.DataTable.SetValue("dtPreload",V.Local.iFor,"DiffCheck",True)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.If(V.Local.bSource,=,True)
			F.Intrinsic.Control.If(V.ODBC.conx!rstSel.FieldValTrim!CODE_SOURCE,<>,V.DataTable.dtPreload(V.Local.iFor).SOURCE!FieldValTrim)
			F.Intrinsic.Control.AndIf(V.DataTable.dtPreload(V.Local.iFor).SOURCE!FieldValTrim,<>,"")
				F.Data.DataTable.SetValue("dtPreload",V.Local.iFor,"DiffCheck",True)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
			F.Intrinsic.Control.If(V.ODBC.conx!rstSel.FieldValTrim!CODE_SORT,<>,V.DataTable.dtPreload(V.Local.iFor).SORTCODE!FieldValTrim)
			F.Intrinsic.Control.AndIf(V.DataTable.dtPreload(V.Local.iFor).SORTCODE!FieldValTrim,<>,"")
				F.Data.DataTable.SetValue("dtPreload",V.Local.iFor,"DiffCheck",True)
			F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.EndIf
	F.ODBC.conx!rstSel.Close
F.Intrinsic.Control.Next(V.Local.iFor)

V.Local.sGv.Set("gvMain")

F.Data.DataView.Create("dtPreload","dvMain")
F.Data.DataView.SetFilter("dtPreload","dvMain","DiffCheck = True")

gui.fMain.GsGcMain.AddGridviewFromDataview(V.Local.sGv,"dtPreload","dvMain")

gui.fMain.GsGcMain.SetGridviewProperty(V.Local.sGv,"AllowAddRows",False)
gui.fMain.GsGcMain.SetGridviewProperty(V.Local.sGv,"AllowDeleteRows",False)
gui.fMain.GsGcMain.SetGridviewProperty(V.Local.sGv,"Editable",True)
gui.fMain.GsGcMain.SetGridviewProperty(V.Local.sGv,"MultiSelect",False)
gui.fMain.GsGcMain.SetGridviewProperty(V.Local.sGv,"ShowGroupPanel",False)

V.Local.sProperty.Set("AllowEdit")
V.Local.sDefault.Set("False")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PARTNO",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"REVISION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"INVPART",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DESCRIPTION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"QUANTITY",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UM",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"COST",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SOURCE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DRAWING",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LEADTIME",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LEVEL",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LOCATION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MEMO1",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MEMO2",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PARENT",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PRODUCTLINE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SEQUENCE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SORTCODE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"TAG",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"CATEGORY",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.If(V.Global.bRouter,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"ROUTER",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Global.bVendor,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"VENDOR_CODE",V.Local.sProperty,V.Local.sDefault)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MFR_PART_NO",V.Local.sProperty,V.Local.sDefault)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MFR_NAME",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Global.bExtDesc,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"EXT_DESCRIPTION",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bPL,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PLCheck",V.Local.sProperty,True)
F.Intrinsic.Control.EndIf
'gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UMCheck",V.Local.sProperty,True)
F.Intrinsic.Control.If(V.Local.bDescription,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DescCheck",V.Local.sProperty,True)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSource,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SrcCheck",V.Local.sProperty,True)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SortCheck",V.Local.sProperty,True)
F.Intrinsic.Control.EndIf
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DiffCheck",V.Local.sProperty,V.Local.sDefault)

V.Local.sProperty.Set("ReadOnly")
V.Local.sDefault.Set("True")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PARTNO",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"REVISION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"INVPART",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DESCRIPTION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"QUANTITY",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UM",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"COST",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SOURCE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DRAWING",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LEADTIME",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LEVEL",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LOCATION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MEMO1",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MEMO2",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PARENT",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PRODUCTLINE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SEQUENCE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SORTCODE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"TAG",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"CATEGORY",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.If(V.Global.bRouter,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"ROUTER",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Global.bVendor,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"VENDOR_CODE",V.Local.sProperty,V.Local.sDefault)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MFR_PART_NO",V.Local.sProperty,V.Local.sDefault)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MFR_NAME",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Global.bExtDesc,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"EXT_DESCRIPTION",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bPL,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PLCheck",V.Local.sProperty,False)
F.Intrinsic.Control.EndIf
'gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UMCheck",V.Local.sProperty,False)
F.Intrinsic.Control.If(V.Local.bDescription,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DescCheck",V.Local.sProperty,False)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSource,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SrcCheck",V.Local.sProperty,False)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SortCheck",V.Local.sProperty,False)
F.Intrinsic.Control.EndIf
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DiffCheck",V.Local.sProperty,V.Local.sDefault)

V.Local.sProperty.Set("HeaderFontBold")
V.Local.sDefault.Set("True")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PARTNO",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"REVISION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"INVPART",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DESCRIPTION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"QUANTITY",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UM",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"COST",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SOURCE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DRAWING",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LEADTIME",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LEVEL",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LOCATION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MEMO1",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MEMO2",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PARENT",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PRODUCTLINE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SEQUENCE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SORTCODE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"TAG",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"CATEGORY",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.If(V.Global.bRouter,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"ROUTER",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Global.bVendor,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"VENDOR_CODE",V.Local.sProperty,V.Local.sDefault)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MFR_PART_NO",V.Local.sProperty,V.Local.sDefault)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MFR_NAME",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Global.bExtDesc,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"EXT_DESCRIPTION",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bPL,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PLCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
'gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UMCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.If(V.Local.bDescription,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DescCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSource,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SrcCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SortCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DiffCheck",V.Local.sProperty,V.Local.sDefault)

V.Local.sProperty.Set("HeaderBackColor")
V.Local.sDefault.Set("MediumSeaGreen")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PARTNO",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"REVISION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"INVPART",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DESCRIPTION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"QUANTITY",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UM",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"COST",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SOURCE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DRAWING",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LEADTIME",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LEVEL",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LOCATION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MEMO1",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MEMO2",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PARENT",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PRODUCTLINE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SEQUENCE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SORTCODE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"TAG",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"CATEGORY",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.If(V.Global.bRouter,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"ROUTER",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Global.bVendor,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"VENDOR_CODE",V.Local.sProperty,V.Local.sDefault)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MFR_PART_NO",V.Local.sProperty,V.Local.sDefault)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MFR_NAME",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Global.bExtDesc,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"EXT_DESCRIPTION",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bPL,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PLCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
'gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UMCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.If(V.Local.bDescription,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DescCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSource,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SrcCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SortCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DiffCheck",V.Local.sProperty,V.Local.sDefault)

V.Local.sProperty.Set("VisibleIndex")
V.Local.iIndex.Set(-1)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PARTNO",V.Local.sProperty,V.Local.iIndex.++)
F.Intrinsic.Control.If(V.Local.bDescription,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DescCheck",V.Local.sProperty,V.Local.iIndex.++)
F.Intrinsic.Control.EndIf
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DESCRIPTION",V.Local.sProperty,V.Local.iIndex.++)
F.Intrinsic.Control.If(V.Local.bPL,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PLCheck",V.Local.sProperty,V.Local.iIndex.++)
F.Intrinsic.Control.EndIf
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PRODUCTLINE",V.Local.sProperty,V.Local.iIndex.++)
'gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UMCheck",V.Local.sProperty,V.Local.iIndex.++)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UM",V.Local.sProperty,V.Local.iIndex.++)
F.Intrinsic.Control.If(V.Local.bSource,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SrcCheck",V.Local.sProperty,V.Local.iIndex.++)
F.Intrinsic.Control.EndIf
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SOURCE",V.Local.sProperty,V.Local.iIndex.++)
F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SortCheck",V.Local.sProperty,V.Local.iIndex.++)
F.Intrinsic.Control.EndIf
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SORTCODE",V.Local.sProperty,V.Local.iIndex.++)

V.Local.sProperty.Set("Caption")
V.Local.sDefault.Set(" ")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PARTNO",V.Local.sProperty,"Part Number")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DESCRIPTION",V.Local.sProperty,"Description")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UM",V.Local.sProperty,"UM")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PRODUCTLINE",V.Local.sProperty,"PL")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SOURCE",V.Local.sProperty,"Source")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SORTCODE",V.Local.sProperty,"Sort Code")

V.Local.sProperty.Set("ShowCaption")
V.Local.sDefault.Set("False")
F.Intrinsic.Control.If(V.Local.bPL,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PLCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
'gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UMCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.If(V.Local.bDescription,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DescCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSource,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SrcCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SortCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf

V.Local.sProperty.Set("MinWidth")
V.Local.sDefault.Set("30")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PARTNO",V.Local.sProperty,120)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DESCRIPTION",V.Local.sProperty,200)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UM",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PRODUCTLINE",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.If(V.Local.bPL,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PLCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
'gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UMCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.If(V.Local.bDescription,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DescCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSource,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SrcCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SOURCE",V.Local.sProperty,50)
F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SortCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SORTCODE",V.Local.sProperty,100)

V.Local.sProperty.Set("MaxWidth")
V.Local.sDefault.Set("30")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UM",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PRODUCTLINE",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.If(V.Local.bPL,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PLCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
'gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"UMCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.If(V.Local.bDescription,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DescCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSource,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SrcCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SortCheck",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf

V.Local.sProperty.Set("CellHAlignment")
V.Local.sDefault.Set("Center")


V.Local.sProperty.Set("CellForeColor")
V.Local.sDefault.Set("Blue")


V.Local.sProperty.Set("CellFontUnderline")
V.Local.sDefault.Set("True")


V.Local.sProperty.Set("DisplayCustomDateTime")
V.Local.sDefault.Set("d")


V.Local.sProperty.Set("Visible")
V.Local.sDefault.Set("False")
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"REVISION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"INVPART",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"QUANTITY",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"COST",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DRAWING",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LEADTIME",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LEVEL",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"LOCATION",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MEMO1",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MEMO2",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PARENT",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"SEQUENCE",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"TAG",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"CATEGORY",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.If(V.Global.bRouter,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"ROUTER",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Global.bVendor,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"VENDOR_CODE",V.Local.sProperty,V.Local.sDefault)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MFR_PART_NO",V.Local.sProperty,V.Local.sDefault)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"MFR_NAME",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Global.bExtDesc,=,True)
	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DescExtra",V.Local.sProperty,V.Local.sDefault)
F.Intrinsic.Control.EndIf
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DiffCheck",V.Local.sProperty,V.Local.sDefault)
'F.Intrinsic.Control.If(V.Global.bAlt1,=,True)
'	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"AltDescription1",V.Local.sProperty,V.Local.sDefault)
'F.Intrinsic.Control.EndIf
'F.Intrinsic.Control.If(V.Global.bAlt2,=,True)
'	gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"AltDescription",V.Local.sProperty,V.Local.sDefault)
'F.Intrinsic.Control.EndIf
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"ALTDESCRIPTION1",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"ALTDESCRIPTION2",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DESCEXTRA",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"ISSUEUM",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"CONSUMPTIONCONV",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DISPLAYPART",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DISPLAYREV",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"PREFERRED",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"APPROVED",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"CUSTOMER",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"CUSTOMER_PART",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"DEFAULT_BIN",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"VENDOR_SORT",V.Local.sProperty,V.Local.sDefault)
gui.fMain.GsGcMain.SetColumnProperty(V.Local.sGv,"BOM_COMMENTS",V.Local.sProperty,V.Local.sDefault)

gui.fMain.GsGcMain.MainView(V.Local.sGv)

F.Intrinsic.UI.CloseWaitDialog

gui.fMain..Show
Program.Sub.loadfmain.End

Program.Sub.fOptions_UnLoad.Start
gui.fOptions..Visible(0)
F.Intrinsic.Control.End

Program.Sub.fOptions_UnLoad.End

Program.Sub.cmdProcess_Click.Start
V.Local.bDescription.Declare
V.Local.bPL.Declare
V.Local.bSource.Declare
V.Local.bSortCode.Declare
V.Local.iFor.Declare
V.Local.iLen.Declare
V.Local.sGSSPart.Declare
V.Local.sRet.Declare
V.Local.sSQL.Declare

gui.fMain..Visible(0)

F.Intrinsic.UI.InvokeWaitDialog("Updating Inventory","BOM Compare - ARC 5308 - Ver: 091120201443")

'Check to see if the options are checked for Description, Source, Product Line, and Sort Code
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 5",V.Local.sRet)
V.Local.bDescription.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal)
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 6",V.Local.sRet)
V.Local.bSource.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal)
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 7",V.Local.sRet)
V.Local.bPL.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal)
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 8",V.Local.sRet)
V.Local.bSortCode.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal)

F.Intrinsic.Control.For(V.Local.iFor,0,V.DataTable.dtPreload.Rowcount--,1)
	F.Intrinsic.UI.ChangeWaitStatus("Updating Inventory",V.Local.iFor,0,V.DataTable.dtPreload.Rowcount--)
	F.Intrinsic.String.GSSPartString(V.DataTable.dtPreload(V.Local.iFor).PartNo!FieldValTrim,V.DataTable.dtPreload(V.Local.iFor).Revision!FieldValTrim,V.Local.sGSSPart)
	F.Intrinsic.String.Trim(V.Local.sGSSPart,V.Local.sGSSPart)
	'Update ProdLine, Unit, Description, Sort Code
	V.Local.sSQL.Set("update INVENTORY_MSTR set")
	F.Intrinsic.Control.If(V.Local.bPL,=,True)
		F.Intrinsic.Control.If(V.DataTable.dtPreload(V.Local.iFor).PLCheck!FieldVal,=,True)
			F.Intrinsic.String.Concat(V.Local.sSQL," PRODUCT_LINE = '",V.DataTable.dtPreload(V.Local.iFor).ProductLine!FieldValTrim,"',",V.Local.sSQL)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.EndIf
		'F.Intrinsic.Control.If(V.DataTable.dtPreload(V.Local.iFor).UMCheck!FieldVal,=,True)
			'F.Intrinsic.String.Concat(V.Local.sSQL," UM_INVENTORY = '",V.DataTable.dtPreload(V.Local.iFor).UM!FieldValTrim,"',",V.Local.sSQL)
		'F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.If(V.Local.bDescription,=,True)
		F.Intrinsic.Control.If(V.DataTable.dtPreload(V.Local.iFor).DescCheck!FieldVal,=,True)
			F.Intrinsic.String.Concat(V.Local.sSQL," DESCRIPTION = '",V.DataTable.dtPreload(V.Local.iFor).Description!FieldValTrim,"',",V.Local.sSQL)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
		F.Intrinsic.Control.If(V.DataTable.dtPreload(V.Local.iFor).SortCheck!FieldVal,=,True)
			F.Intrinsic.String.Concat(V.Local.sSQL," CODE_SORT = '",V.DataTable.dtPreload(V.Local.iFor).SortCode!FieldValTrim,"'",V.Local.sSQL)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.If(V.Local.sSQL.Right3,<>,"set")
		'Strip out the last comma if necessary
		F.Intrinsic.Control.If(V.Local.sSQL.Right1,=,",")
			F.Intrinsic.String.Len(V.Local.sSQL,V.Local.iLen)
			F.Intrinsic.String.Left(V.Local.sSQL,V.Local.iLen.--,V.Local.sSQL)
		F.Intrinsic.Control.EndIf
		F.Intrinsic.String.Concat(V.Local.sSQL," where PART = '",V.Local.sGSSPart,"'",V.Local.sSQL)
		F.ODBC.Connection!conx.Execute(V.Local.sSQL)
	F.Intrinsic.Control.EndIf

	'Update Source
	F.Intrinsic.Control.If(V.Local.bSource,=,True)
		V.Local.sSQL.Set("update INVENTORY_MST2 set")
		F.Intrinsic.Control.If(V.DataTable.dtPreload(V.Local.iFor).SrcCheck!FieldVal,=,True)
			F.Intrinsic.String.Concat(V.Local.sSQL," CODE_SOURCE = '",V.DataTable.dtPreload(V.Local.iFor).Source!FieldValTrim,"',",V.Local.sSQL)
		F.Intrinsic.Control.EndIf
		F.Intrinsic.Control.If(V.Local.sSQL.Right3,<>,"set")
			'Strip out the last comma if necessary
			F.Intrinsic.Control.If(V.Local.sSQL.Right1,=,",")
				F.Intrinsic.String.Len(V.Local.sSQL,V.Local.iLen)
				F.Intrinsic.String.Left(V.Local.sSQL,V.Local.iLen.--,V.Local.sSQL)
			F.Intrinsic.Control.EndIf
			F.Intrinsic.String.Concat(V.Local.sSQL," where PART = '",V.Local.sGSSPart,"'",V.Local.sSQL)
			F.ODBC.Connection!conx.Execute(V.Local.sSQL)
		F.Intrinsic.Control.EndIf
	F.Intrinsic.Control.EndIf
F.Intrinsic.Control.Next(V.Local.iFor)

'Remove Columns for Product line, Unit of Measure, and Description Checkboxes
F.Intrinsic.Control.If(V.Local.bPL,=,True)
	F.Data.DataTable.RemoveColumn("dtPreload","PLCheck")
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bDescription,=,True)
	F.Data.DataTable.RemoveColumn("dtPreload","DescCheck")
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSource,=,True)
	F.Data.DataTable.RemoveColumn("dtPreload","SrcCheck")
F.Intrinsic.Control.EndIf
F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
	F.Data.DataTable.RemoveColumn("dtPreload","SortCheck")
F.Intrinsic.Control.EndIf
F.Data.DataTable.RemoveColumn("dtPreload","DiffCheck")

F.Intrinsic.Control.CallSub(savepreloadbdf)

F.Intrinsic.UI.CloseWaitDialog

'Disconnect
F.Intrinsic.Control.CallSub(disconnect)
Program.Sub.cmdProcess_Click.End

Program.Sub.chkDefaultBin_Click.Start
Program.Sub.chkDefaultBin_Click.End

Program.Sub.chkPreviewSC_Click.Start
Program.Sub.chkPreviewSC_Click.End

Program.Sub.cmdSelectAll_Click.Start
V.Local.bDescription.Declare
V.Local.bPL.Declare
V.Local.bSource.Declare
V.Local.bSortCode.Declare
V.Local.iFor.Declare
V.Local.sRet.Declare


gui.fMain..Enabled(0)

'Check to see if the options are checked for Description, Source, Product Line, and Sort Code
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 5",V.Local.sRet)
V.Local.bDescription.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal)
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 6",V.Local.sRet)
V.Local.bSource.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal)
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 7",V.Local.sRet)
V.Local.bPL.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal)
F.Data.DataTable.Select("dtOptions","HOOK = 50310 and SEQ = 8",V.Local.sRet)
V.Local.bSortCode.Set(V.DataTable.dtOptions(V.Local.sRet).BVAL!FieldVal)

'F.Intrinsic.Control.For(V.Local.iFor,0,V.DataTable.dtPreload.Rowcount--,1)
'	'Check ProdLine, Unit, Description, Sort Code, and Source
'	F.Intrinsic.Control.If(V.Global.bSel,=,True)
'		V.Global.bSel.Set(False)
'	F.Intrinsic.Control.Else
'		V.Global.bSel.Set(True)
'	F.Intrinsic.Control.EndIf
'	F.Intrinsic.Control.If(V.Local.bPL,=,True)
'		F.Data.DataTable.SetValue("dtPreload",V.Local.iFor,"PLCheck",V.Global.bSel)
'	F.Intrinsic.Control.EndIf

'	F.Intrinsic.Control.If(V.Local.bDescription,=,True)
'		F.Data.DataTable.SetValue("dtPreload",V.Local.iFor,"DescCheck",V.Global.bSel)
'	F.Intrinsic.Control.EndIf
'	
'	F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
'		F.Data.DataTable.SetValue("dtPreload",V.Local.iFor,"SortCheck",V.Global.bSel)
'	F.Intrinsic.Control.EndIf

'	F.Intrinsic.Control.If(V.Local.bSource,=,True)
'		F.Data.DataTable.SetValue("dtPreload",V.Local.iFor,"SrcCheck",V.Global.bSel)
'	F.Intrinsic.Control.EndIf
'F.Intrinsic.Control.Next(V.Local.iFor)

f.Intrinsic.Control.If(v.Screen.fMain!lblSelAll.Text,=,"False")
	v.Global.bSel.Set(True)
	gui.fMain.lblSelAll.Text("True")
f.Intrinsic.Control.else
	v.Global.bSel.Set(False)
	gui.fMain.lblSelAll.Text("False")
f.Intrinsic.Control.EndIf

'Check ProdLine, Unit, Description, Sort Code, and Source
F.Intrinsic.Control.If(V.Local.bPL,=,True)
	F.Data.DataTable.SetValue("dtPreload",-1,"PLCheck",V.Global.bSel)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.If(V.Local.bDescription,=,True)
	F.Data.DataTable.SetValue("dtPreload",-1,"DescCheck",V.Global.bSel)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.If(V.Local.bSortCode,=,True)
	F.Data.DataTable.SetValue("dtPreload",-1,"SortCheck",V.Global.bSel)
F.Intrinsic.Control.EndIf

F.Intrinsic.Control.If(V.Local.bSource,=,True)
	F.Data.DataTable.SetValue("dtPreload",-1,"SrcCheck",V.Global.bSel)
F.Intrinsic.Control.EndIf

gui.fMain..Enabled(1)
Program.Sub.cmdSelectAll_Click.End

Program.Sub.CheckLongPart.Start
	' System Support > Administration > Company Options (Advanced) > Inventory
	'	At the bottom, either Use Long Part (Large Inventory) or Use Long Part (Small Inventory)
	F.Global.General.ReadOption("400861",0,False,"0000",V.Global.bLongPart)
	F.Intrinsic.Control.If(V.Global.bLongPart,=,False)
		F.Global.General.ReadOption("400861",0,False,"0004",V.Global.bLongPart)
	F.Intrinsic.Control.EndIf
	
	F.Global.General.ReadOption("400861",0,False,"0001",V.Global.bLongMfgXref)
Program.Sub.CheckLongPart.End
Program.Sub.Form_UnLoad.Start
V.Local.sFileTarget.Declare
V.Local.sRet.Declare
v.Local.bExist.Declare
F.Intrinsic.String.Build("{0}Temp_6059.txt",V.Caller.LocalGSSTempDir,V.Local.sFileTarget)

f.Intrinsic.File.Exists(v.Local.sFileTarget,v.Local.bExist)
f.Intrinsic.Control.If(v.Local.bExist)
	f.Intrinsic.File.DeleteFile(v.Local.sFileTarget)
f.Intrinsic.Control.EndIf

f.Intrinsic.Control.If(v.Screen.Form!optCusBOMCompare.Value,=,True)
	f.Intrinsic.File.String2File(v.Local.sFileTarget,"CusBOMCompare")
f.Intrinsic.Control.Else
	f.Intrinsic.File.String2File(v.Local.sFileTarget,"RegBOMCompare")
f.Intrinsic.Control.EndIf
gui.Form..Visible(false)
Program.Sub.Form_UnLoad.End

Program.Sub.Comments.Start
${$0$}$$}$JWERTH$}$11/9/2018 10:31:57 AM$}$False
${$5$}$2.0.0.0$}$2
${$6$}$bpham$}$20211004110000131$}$Di0riF4Q5RIv6jxva5zSWDOOsXP37NsozYhSPHFSNRjtqu8li+WlUaFnEaQZnCjSy4PEBfdToUU=
Program.Sub.Comments.End
